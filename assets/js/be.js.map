{"version":3,"sources":["../../assets_src/js/be/jquery.cookie.js","../../assets_src/js/be/tree.jquery.js","../../assets_src/js/be/treestructure.js"],"names":["factory","define","amd","exports","module","require","jQuery","$","encode","s","config","raw","encodeURIComponent","decode","decodeURIComponent","stringifyCookieValue","value","json","JSON","stringify","String","parseCookieValue","indexOf","slice","replace","pluses","parse","e","read","converter","isFunction","cookie","key","options","arguments","length","extend","defaults","expires","days","t","Date","setMilliseconds","getMilliseconds","document","toUTCString","path","domain","secure","join","result","undefined","cookies","split","i","l","parts","name","shift","removeCookie","n","r","o","u","a","f","Error","code","call","1","DragAndDropHandler","DragElement","HitAreasGenerator","Position","VisibleNodeIterator","node_module","child","parent","ctor","this","constructor","hasProp","prototype","__super__","hasOwnProperty","tree_widget","hovered_area","$ghost","hit_areas","is_dragging","current_item","mouseCapture","position_info","$element","node_element","target","mustCaptureElement","onIsMoveHandle","_getNodeElement","onCanMove","node","mouseStart","offset","refresh","drag_element","page_x","left","page_y","top","element","addClass","mouseDrag","area","can_move_to","move","findHoveredArea","canMoveToArea","isFolder","stopOpenFolderTimer","mustOpenFolderTimer","startOpenFolderTimer","updateDropHint","removeHover","removeDropHint","onDragMove","original_event","is","position_name","onCanMoveTo","getName","position","mouseStop","moveItem","clear","removeHitAreas","removeClass","onDragStop","generateHitAreas","_getNodeElementForNode","remove","previous_ghost","hit_areas_generator","tree","getTreeDimensions","bottom","generate","x","y","dimensions","high","low","mid","right","is_open","INSIDE","addDropHint","folder","openFolder","_this","_openNode","slide","open_folder_timer","setTimeout","openFolderDelay","clearTimeout","doMove","event","moved_node","previous_parent","target_node","NONE","new_target_node","new_position","moveNode","empty","_refreshElements","_triggerEvent","move_info","do_move","isDefaultPrevented","width","height","iterate","_iterateNode","is_first_node","next_node","children_length","j","len","must_iterate_inside","ref","hasChildren","handleFirstNode","handleOpenFolder","handleClosedFolder","handleNode","children","handleAfterOpenFolder","superClass","current_node","tree_bottom","positions","last_top","getTop","addPosition","push","AFTER","BEFORE","group","previous_top","generateHitAreasForGroup","positions_in_group","area_height","area_top","position_count","sub","Math","min","round","offset_x","offset_y","$tree","css","append","./node","2","ElementsRenderer","NodeElement","html_escape","util","opened_icon_element","createButtonElement","openedIcon","closed_icon_element","closedIcon","render","from_node","renderFromNode","renderFromRoot","createDomElements","$previous_li","li","createLi","attachNodeData","after","getLevel","is_root_node","level","ul","createUl","appendChild","data","class_string","role","rtl","createElement","className","setAttribute","is_selected","select_node_handler","isNodeSelected","createFolderLi","createNodeLi","onCreateLi","button_classes","button_link","div","folder_classes","icon_element","is_folder","getButtonClasses","getFolderClasses","cloneNode","buttonLeft","createTitleSpan","li_classes","node_name","classes","title_span","getBoolString","innerHTML","escapeIfNecessary","is_loading","autoEscape","createTextNode","./node_element","./util","3","KeyHandler","bind","fn","me","apply","selectNode","keyboardSupport","proxy","handleKeyDown","DOWN","LEFT","RIGHT","UP","deinit","unbind","moveDown","getSelectedNode","getNextNode","moveUp","getPreviousNode","moveRight","openNode","moveLeft","closeNode","getParent","activeElement","which","scroll_handler","isScrolledIntoView","find","scrollToNode","4","MouseWidget","SimpleWidget","is_mouse_handled","_init","$el","_mouseDown","_touchStart","is_mouse_started","mouse_delay","_mouse_delay_timer","_is_mouse_delay_met","mouse_down_info","_deinit","$document","_handleMouseDown","_getPositionInfo","preventDefault","_handleMouseUp","_mouseCapture","_handleStartMouse","_mouseMove","_touchMove","_mouseUp","_touchEnd","_startMouseDelayTimer","_handleMouseMove","_mouseDrag","_mouseStart","pageX","pageY","_mouseStop","setMouseDelay","touch","originalEvent","touches","changedTouches","./simple.widget","5","Node","strings","nameToIndex","is_root","node_class","setData","id_mapping","setName","initFromData","addChildren","addNode","node_data","children_data","addChild","loadFromData","removeChildren","_setParent","addChildAtPosition","index","splice","addNodeToIndex","removeChild","_removeChild","getChildIndex","removeNodeFromIndex","inArray","load_on_demand","callback","_iterate","isParentOf","getData","include_parent","getDataFromNodes","nodes","k","tmp_node","v","Object","getNodeByName","addAfter","node_info","child_index","addBefore","addParent","new_parent","original_parent","prepend","getNodeById","node_id","id","getPreviousSibling","previous_index","getNextSibling","next_index","getNodesByProperty","filter","include_children","next_sibling","previous_sibling","getLastChild","last_child","6","BorderDropHint","FolderElement","GhostDropHint","init","getUl","getSpan","getLi","select","$li","$span","attr","deselect","open","on_finished","$button","doOpen","getButton","html","renderer","slideDown","show","close","doClose","slideUp","hide","dnd_handler","$div","$hint","outerHeight","moveAfter","moveBefore","moveInsideOpenFolder","moveInside","before","7","SaveStateHandler","isInt","saveState","state","getState","onSetStateFromStorage","supportsLocalStorage","localStorage","setItem","getCookieName","getStateFromStorage","json_data","_loadFromStorage","_parseState","parseJSON","selected_node","onGetStateFromStorage","getItem","getOpenNodeIds","getSelectedNodeIds","open_nodes","results","getSelectedNodes","setInitialState","must_load_on_demand","_openInitialNodes","_selectInitialNodes","node_ids","select_count","addToSelection","setInitialStateOnDemand","cb_finished","_setInitialStateOnDemand","selected_nodes","loadAndOpenNode","loading_count","openNodes","new_nodes_ids","testSupport","error","sessionStorage","removeItem","error1","_supportsLocalStorage","getNodeIdToBeSelected","8","ScrollHandler","is_initialized","_initScrollParent","$scroll_parent","getParentWithOverflow","setDocumentAsScrollParent","css_values","el","hasOverFlow","css_value","parents","scroll_parent_top","tagName","_ensureInit","checkScrolling","_handleScrollingWithScrollParent","_handleScrollingWithDocument","distance_bottom","offsetHeight","scrollTop","refreshHitAreas","distance_top","window","scrollTo","tree_top","element_bottom","element_top","view_bottom","view_top","9","SelectNodeHandler","selected_single_node","getSelectedNodesUnder","removeFromSelection","10","destroy","register","widget_class","widget_name","callFunction","createWidget","destroyWidget","getDataKey","getWidgetData","data_key","widget","existing_widget","removeData","function_name","args","widget_function","argument1","11","JqTreeWidget","__version__","ref1","util_module","autoOpen","dragAndDrop","selectable","useContextMenu","onCanSelectNode","onLoadFailed","dataUrl","nodeClass","dataFilter","toggle","getTree","_selectNode","must_toggle","canSelect","deselected_node","openParents","save_state_handler","_deselectCurrentNode","previous_node","toJson","loadData","parent_node","_loadData","loadDataFromUrl","param1","param2","param3","type","_loadDataFromUrl","reload","url_info","addLoadingClass","handeLoadData","loadDataFromUrlInfo","parseUrlInfo","removeLoadingClass","url","method","ajax","toUpperCase","cache","dataType","success","response","isArray","_getDataUrlInfo","deselectNodes","loadSubtree","selected_nodes_under_parent","tree_data","_initTree","isDragging","doOpenNode","_node","_slide","_on_finished","folder_element","_loadFolderOnDemand","_saveState","addNodeAfter","new_node_info","existing_node","new_node","addNodeBefore","addParentNode","removeNode","appendNode","prependNode","updateNode","id_is_changed","_selectCurrentNode","position_index","setState","setOption","option","key_handler","getVersion","_getRtlOption","_getDefaultClosedIcon","_initData","click","_click","dblclick","_dblclick","_contextmenu","data_url","getUrlFromString","selected_node_id","_getNodeIdToBeSelected","doInit","_setInitialState","autoOpenNodes","is_restored","ref2","restoreState","max_level","_getAutoOpenMaxLevel","parseInt","click_target","_getClickTarget","stopPropagation","click_event","$target","closest","_getNode","event_name","values","Event","trigger","testGenerateHitAreas","moving_node","data_rtl","getModule","modules","./drag_and_drop_handler","./elements_renderer","./key_handler","./mouse.widget","./save_state_handler","./scroll_handler","./select_node_handler","./version","12","_indexOf","array","item","string","13","rex_treestructure","treeCss","new_article","new_category","is_touch","documentElement","createEvents","createTree","on","click.treestructure","action","match","first","g","itemActions","valid","shiftKey","prompt","_translate","confirm","mousedown.treestructure","ev","submit.treestructure","val","trim","ajaxAction","serialize","updateTree","reset.treestructure","each","states","editTree","hasClass","keyCode","off","loadingTree","replacements","translations","p","formData","onSuccess","FormData","keys","map","request","XMLHttpRequest","setRequestHeader","onload","alert","responseText","status","duration","wait","notice","text","insertBefore","animate","opacity","send","delete","force","edit","category_id","focus","newCategory","_newElement","newArticle","newNode","label","targetNode","test","has_children","cat_perm","last","view","metadata","location","href","functions","_expandCollapseAll","expandAll","collapseAll","sameCategory","nextTargetItem","prevTargetItem","permissions","moveNodeBeforeTargetNode","prior","next","clone","insertAfter","tree.move","container"],"mappings":"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","file":"be.js","sourcesContent":["/*!\n * jQuery Cookie Plugin v1.4.1\n * https://github.com/carhartl/jquery-cookie\n *\n * Copyright 2006, 2014 Klaus Hartl\n * Released under the MIT license\n */\n(function (factory) {\n\tif (typeof define === 'function' && define.amd) {\n\t\t// AMD (Register as an anonymous module)\n\t\tdefine(['jquery'], factory);\n\t} else if (typeof exports === 'object') {\n\t\t// Node/CommonJS\n\t\tmodule.exports = factory(require('jquery'));\n\t} else {\n\t\t// Browser globals\n\t\tfactory(jQuery);\n\t}\n}(function ($) {\n\n\tvar pluses = /\\+/g;\n\n\tfunction encode(s) {\n\t\treturn config.raw ? s : encodeURIComponent(s);\n\t}\n\n\tfunction decode(s) {\n\t\treturn config.raw ? s : decodeURIComponent(s);\n\t}\n\n\tfunction stringifyCookieValue(value) {\n\t\treturn encode(config.json ? JSON.stringify(value) : String(value));\n\t}\n\n\tfunction parseCookieValue(s) {\n\t\tif (s.indexOf('\"') === 0) {\n\t\t\t// This is a quoted cookie as according to RFC2068, unescape...\n\t\t\ts = s.slice(1, -1).replace(/\\\\\"/g, '\"').replace(/\\\\\\\\/g, '\\\\');\n\t\t}\n\n\t\ttry {\n\t\t\t// Replace server-side written pluses with spaces.\n\t\t\t// If we can't decode the cookie, ignore it, it's unusable.\n\t\t\t// If we can't parse the cookie, ignore it, it's unusable.\n\t\t\ts = decodeURIComponent(s.replace(pluses, ' '));\n\t\t\treturn config.json ? JSON.parse(s) : s;\n\t\t} catch(e) {}\n\t}\n\n\tfunction read(s, converter) {\n\t\tvar value = config.raw ? s : parseCookieValue(s);\n\t\treturn $.isFunction(converter) ? converter(value) : value;\n\t}\n\n\tvar config = $.cookie = function (key, value, options) {\n\n\t\t// Write\n\n\t\tif (arguments.length > 1 && !$.isFunction(value)) {\n\t\t\toptions = $.extend({}, config.defaults, options);\n\n\t\t\tif (typeof options.expires === 'number') {\n\t\t\t\tvar days = options.expires, t = options.expires = new Date();\n\t\t\t\tt.setMilliseconds(t.getMilliseconds() + days * 864e+5);\n\t\t\t}\n\n\t\t\treturn (document.cookie = [\n\t\t\t\tencode(key), '=', stringifyCookieValue(value),\n\t\t\t\toptions.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE\n\t\t\t\toptions.path    ? '; path=' + options.path : '',\n\t\t\t\toptions.domain  ? '; domain=' + options.domain : '',\n\t\t\t\toptions.secure  ? '; secure' : ''\n\t\t\t].join(''));\n\t\t}\n\n\t\t// Read\n\n\t\tvar result = key ? undefined : {},\n\t\t\t// To prevent the for loop in the first place assign an empty array\n\t\t\t// in case there are no cookies at all. Also prevents odd result when\n\t\t\t// calling $.cookie().\n\t\t\tcookies = document.cookie ? document.cookie.split('; ') : [],\n\t\t\ti = 0,\n\t\t\tl = cookies.length;\n\n\t\tfor (; i < l; i++) {\n\t\t\tvar parts = cookies[i].split('='),\n\t\t\t\tname = decode(parts.shift()),\n\t\t\t\tcookie = parts.join('=');\n\n\t\t\tif (key === name) {\n\t\t\t\t// If second argument (value) is a function it's a converter...\n\t\t\t\tresult = read(cookie, value);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// Prevent storing a cookie that we couldn't decode.\n\t\t\tif (!key && (cookie = read(cookie)) !== undefined) {\n\t\t\t\tresult[name] = cookie;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tconfig.defaults = {};\n\n\t$.removeCookie = function (key, options) {\n\t\t// Must not alter options, thus extending a fresh object...\n\t\t$.cookie(key, '', $.extend({}, options, { expires: -1 }));\n\t\treturn !$.cookie(key);\n\t};\n\n}));","(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nvar $, DragAndDropHandler, DragElement, HitAreasGenerator, Position, VisibleNodeIterator, node_module,\n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  hasProp = {}.hasOwnProperty;\n\nnode_module = require('./node');\n\nPosition = node_module.Position;\n\n$ = jQuery;\n\nDragAndDropHandler = (function() {\n  function DragAndDropHandler(tree_widget) {\n    this.tree_widget = tree_widget;\n    this.hovered_area = null;\n    this.$ghost = null;\n    this.hit_areas = [];\n    this.is_dragging = false;\n    this.current_item = null;\n  }\n\n  DragAndDropHandler.prototype.mouseCapture = function(position_info) {\n    var $element, node_element;\n    $element = $(position_info.target);\n    if (!this.mustCaptureElement($element)) {\n      return null;\n    }\n    if (this.tree_widget.options.onIsMoveHandle && !this.tree_widget.options.onIsMoveHandle($element)) {\n      return null;\n    }\n    node_element = this.tree_widget._getNodeElement($element);\n    if (node_element && this.tree_widget.options.onCanMove) {\n      if (!this.tree_widget.options.onCanMove(node_element.node)) {\n        node_element = null;\n      }\n    }\n    this.current_item = node_element;\n    return this.current_item !== null;\n  };\n\n  DragAndDropHandler.prototype.mouseStart = function(position_info) {\n    var offset;\n    this.refresh();\n    offset = $(position_info.target).offset();\n    this.drag_element = new DragElement(this.current_item.node, position_info.page_x - offset.left, position_info.page_y - offset.top, this.tree_widget.element);\n    this.is_dragging = true;\n    this.current_item.$element.addClass('jqtree-moving');\n    return true;\n  };\n\n  DragAndDropHandler.prototype.mouseDrag = function(position_info) {\n    var area, can_move_to;\n    this.drag_element.move(position_info.page_x, position_info.page_y);\n    area = this.findHoveredArea(position_info.page_x, position_info.page_y);\n    can_move_to = this.canMoveToArea(area);\n\n    if (can_move_to && area) {\n      if (!area.node.isFolder()) {\n        this.stopOpenFolderTimer();\n      }\n      if (this.hovered_area !== area) {\n        this.hovered_area = area;\n        if (this.mustOpenFolderTimer(area)) {\n          this.startOpenFolderTimer(area.node);\n        } else {\n          this.stopOpenFolderTimer();\n        }\n        this.updateDropHint();\n      }\n    } else {\n      this.removeHover();\n      this.removeDropHint();\n      this.stopOpenFolderTimer();\n    }\n    if (!area) {\n      if (this.tree_widget.options.onDragMove != null) {\n        this.tree_widget.options.onDragMove(this.current_item.node, position_info.original_event);\n      }\n    }\n    return true;\n  };\n\n  DragAndDropHandler.prototype.mustCaptureElement = function($element) {\n    return !$element.is('input,select');\n  };\n\n  DragAndDropHandler.prototype.canMoveToArea = function(area) {\n    var position_name;\n    if (!area) {\n      return false;\n    } else if (this.tree_widget.options.onCanMoveTo) {\n      position_name = Position.getName(area.position);\n      return this.tree_widget.options.onCanMoveTo(this.current_item.node, area.node, position_name);\n    } else {\n      return true;\n    }\n  };\n\n  DragAndDropHandler.prototype.mouseStop = function(position_info) {\n    var current_item;\n    this.moveItem(position_info);\n    this.clear();\n    this.removeHover();\n    this.removeDropHint();\n    this.removeHitAreas();\n    current_item = this.current_item;\n    if (this.current_item) {\n      this.current_item.$element.removeClass('jqtree-moving');\n      this.current_item = null;\n    }\n    this.is_dragging = false;\n    if (!this.hovered_area && current_item) {\n      if (this.tree_widget.options.onDragStop != null) {\n        this.tree_widget.options.onDragStop(current_item.node, position_info.original_event);\n      }\n    }\n    return false;\n  };\n\n  DragAndDropHandler.prototype.refresh = function() {\n    this.removeHitAreas();\n    if (this.current_item) {\n      this.generateHitAreas();\n      this.current_item = this.tree_widget._getNodeElementForNode(this.current_item.node);\n      if (this.is_dragging) {\n        return this.current_item.$element.addClass('jqtree-moving');\n      }\n    }\n  };\n\n  DragAndDropHandler.prototype.removeHitAreas = function() {\n    return this.hit_areas = [];\n  };\n\n  DragAndDropHandler.prototype.clear = function() {\n    this.drag_element.remove();\n    return this.drag_element = null;\n  };\n\n  DragAndDropHandler.prototype.removeDropHint = function() {\n    if (this.previous_ghost) {\n      return this.previous_ghost.remove();\n    }\n  };\n\n  DragAndDropHandler.prototype.removeHover = function() {\n    return this.hovered_area = null;\n  };\n\n  DragAndDropHandler.prototype.generateHitAreas = function() {\n    var hit_areas_generator;\n    hit_areas_generator = new HitAreasGenerator(this.tree_widget.tree, this.current_item.node, this.getTreeDimensions().bottom);\n    return this.hit_areas = hit_areas_generator.generate();\n  };\n\n  DragAndDropHandler.prototype.findHoveredArea = function(x, y) {\n    var area, dimensions, high, low, mid;\n    dimensions = this.getTreeDimensions();\n    if (x < dimensions.left || y < dimensions.top || x > dimensions.right || y > dimensions.bottom) {\n      return null;\n    }\n    low = 0;\n    high = this.hit_areas.length;\n\n    while (low < high) {\n      mid = (low + high) >> 1;\n      area = this.hit_areas[mid];\n      if (y < area.top) {\n        high = mid;\n      } else if (y > area.bottom) {\n        low = mid + 1;\n      } else {\n        return area;\n      }\n    }\n    return null;\n  };\n\n  DragAndDropHandler.prototype.mustOpenFolderTimer = function(area) {\n    var node;\n    node = area.node;\n    return node.isFolder() && !node.is_open && area.position === Position.INSIDE;\n  };\n\n  DragAndDropHandler.prototype.updateDropHint = function() {\n    var node_element;\n    if (!this.hovered_area) {\n      return;\n    }\n    this.removeDropHint();\n    node_element = this.tree_widget._getNodeElementForNode(this.hovered_area.node);\n    return this.previous_ghost = node_element.addDropHint(this.hovered_area.position);\n  };\n\n  DragAndDropHandler.prototype.startOpenFolderTimer = function(folder) {\n    var openFolder;\n    openFolder = (function(_this) {\n      return function() {\n        return _this.tree_widget._openNode(folder, _this.tree_widget.options.slide, function() {\n          _this.refresh();\n          return _this.updateDropHint();\n        });\n      };\n    })(this);\n    this.stopOpenFolderTimer();\n    return this.open_folder_timer = setTimeout(openFolder, this.tree_widget.options.openFolderDelay);\n  };\n\n  DragAndDropHandler.prototype.stopOpenFolderTimer = function() {\n    if (this.open_folder_timer) {\n      clearTimeout(this.open_folder_timer);\n      return this.open_folder_timer = null;\n    }\n  };\n\n  DragAndDropHandler.prototype.moveItem = function(position_info) {\n    var doMove, event, moved_node, position, previous_parent, target_node;\n    if (this.hovered_area && this.hovered_area.position !== Position.NONE && this.canMoveToArea(this.hovered_area)) {\n      moved_node = this.current_item.node;\n      target_node = this.hovered_area.node;\n      position = this.hovered_area.position;\n      previous_parent = moved_node.parent;\n      if (position === Position.INSIDE) {\n        this.hovered_area.node.is_open = true;\n      }\n      doMove = (function(_this) {\n        return function(new_target_node, new_position) {\n          _this.tree_widget.tree.moveNode(\n              moved_node,\n              new_target_node || target_node,\n              new_position || position\n          );\n          _this.tree_widget.element.empty();\n          return _this.tree_widget._refreshElements();\n        };\n      })(this);\n      event = this.tree_widget._triggerEvent('tree.move', {\n        move_info: {\n          moved_node: moved_node,\n          target_node: target_node,\n          position: Position.getName(position),\n          previous_parent: previous_parent,\n          do_move: doMove,\n          original_event: position_info.original_event\n        }\n      });\n      if (!event.isDefaultPrevented()) {\n        return doMove();\n      }\n    }\n  };\n\n  DragAndDropHandler.prototype.getTreeDimensions = function() {\n    var offset;\n    offset = this.tree_widget.element.offset();\n    return {\n      left: offset.left,\n      top: offset.top,\n      right: offset.left + this.tree_widget.element.width(),\n      bottom: offset.top + this.tree_widget.element.height() + 16\n    };\n  };\n\n  return DragAndDropHandler;\n\n})();\n\nVisibleNodeIterator = (function() {\n  function VisibleNodeIterator(tree) {\n    this.tree = tree;\n  }\n\n  VisibleNodeIterator.prototype.iterate = function() {\n    var _iterateNode, is_first_node;\n    is_first_node = true;\n    _iterateNode = (function(_this) {\n      return function(node, next_node) {\n        var $element, child, children_length, i, j, len, must_iterate_inside, ref;\n        must_iterate_inside = (node.is_open || !node.element) && node.hasChildren();\n        if (node.element) {\n          $element = $(node.element);\n          if (!$element.is(':visible')) {\n            return;\n          }\n          if (is_first_node) {\n            _this.handleFirstNode(node, $element);\n            is_first_node = false;\n          }\n          if (!node.hasChildren()) {\n            _this.handleNode(node, next_node, $element);\n          } else if (node.is_open) {\n            if (!_this.handleOpenFolder(node, $element)) {\n              must_iterate_inside = false;\n            }\n          } else {\n            _this.handleClosedFolder(node, next_node, $element);\n          }\n        }\n        if (must_iterate_inside) {\n          children_length = node.children.length;\n          ref = node.children;\n          for (i = j = 0, len = ref.length; j < len; i = ++j) {\n            child = ref[i];\n            if (i === (children_length - 1)) {\n              _iterateNode(node.children[i], null);\n            } else {\n              _iterateNode(node.children[i], node.children[i + 1]);\n            }\n          }\n          if (node.is_open) {\n            return _this.handleAfterOpenFolder(node, next_node, $element);\n          }\n        }\n      };\n    })(this);\n    return _iterateNode(this.tree, null);\n  };\n\n  VisibleNodeIterator.prototype.handleNode = function(node, next_node, $element) {};\n\n  VisibleNodeIterator.prototype.handleOpenFolder = function(node, $element) {};\n\n  VisibleNodeIterator.prototype.handleClosedFolder = function(node, next_node, $element) {};\n\n  VisibleNodeIterator.prototype.handleAfterOpenFolder = function(node, next_node, $element) {};\n\n  VisibleNodeIterator.prototype.handleFirstNode = function(node, $element) {};\n\n  return VisibleNodeIterator;\n\n})();\n\nHitAreasGenerator = (function(superClass) {\n  extend(HitAreasGenerator, superClass);\n\n  function HitAreasGenerator(tree, current_node, tree_bottom) {\n    HitAreasGenerator.__super__.constructor.call(this, tree);\n    this.current_node = current_node;\n    this.tree_bottom = tree_bottom;\n  }\n\n  HitAreasGenerator.prototype.generate = function() {\n    this.positions = [];\n    this.last_top = 0;\n    this.iterate();\n    return this.generateHitAreas(this.positions);\n  };\n\n  HitAreasGenerator.prototype.getTop = function($element) {\n    return $element.offset().top;\n  };\n\n  HitAreasGenerator.prototype.addPosition = function(node, position, top) {\n    var area;\n    area = {\n      top: top,\n      node: node,\n      position: position\n    };\n    this.positions.push(area);\n    return this.last_top = top;\n  };\n\n  HitAreasGenerator.prototype.handleNode = function(node, next_node, $element) {\n    var top;\n    top = this.getTop($element);\n    if (node === this.current_node) {\n      this.addPosition(node, Position.NONE, top);\n    } else {\n      this.addPosition(node, Position.INSIDE, top);\n    }\n    if (next_node === this.current_node || node === this.current_node) {\n      return this.addPosition(node, Position.NONE, top);\n    } else {\n      return this.addPosition(node, Position.AFTER, top);\n    }\n  };\n\n  HitAreasGenerator.prototype.handleOpenFolder = function(node, $element) {\n    /*\n    // Disabled as it produces errors when an item is moved within itself - do not forget to include an exception by adding a OnCanMove handler\n    if (node === this.current_node) {\n      return false;\n    }\n    */\n    if (node.children[0] !== this.current_node) {\n      this.addPosition(node, Position.INSIDE, this.getTop($element));\n    }\n    return true;\n  };\n\n  HitAreasGenerator.prototype.handleClosedFolder = function(node, next_node, $element) {\n    var top;\n    top = this.getTop($element);\n    if (node === this.current_node) {\n      return this.addPosition(node, Position.NONE, top);\n    } else {\n      this.addPosition(node, Position.INSIDE, top);\n      if (next_node !== this.current_node) {\n        return this.addPosition(node, Position.AFTER, top);\n      }\n    }\n  };\n\n  HitAreasGenerator.prototype.handleFirstNode = function(node, $element) {\n    if (node !== this.current_node) {\n      return this.addPosition(node, Position.BEFORE, this.getTop($(node.element)));\n    }\n  };\n\n  HitAreasGenerator.prototype.handleAfterOpenFolder = function(node, next_node, $element) {\n    if (node === this.current_node.node || next_node === this.current_node.node) {\n      return this.addPosition(node, Position.NONE, this.last_top);\n    } else {\n      return this.addPosition(node, Position.AFTER, this.last_top);\n    }\n  };\n\n  HitAreasGenerator.prototype.generateHitAreas = function(positions) {\n    var group, hit_areas, j, len, position, previous_top;\n    previous_top = -1;\n    group = [];\n    hit_areas = [];\n    for (j = 0, len = positions.length; j < len; j++) {\n      position = positions[j];\n\n      if (position.top !== previous_top && group.length) {\n        if (group.length) {\n          this.generateHitAreasForGroup(hit_areas, group, previous_top, position.top);\n        }\n        previous_top = position.top;\n        group = [];\n      }\n      group.push(position);\n    }\n\n    this.generateHitAreasForGroup(hit_areas, group, previous_top, this.tree_bottom);\n    return hit_areas;\n  };\n\n  HitAreasGenerator.prototype.generateHitAreasForGroup = function(hit_areas, positions_in_group, top, bottom) {\n    var area_height, area_top, i, position, position_count, sub = 0;\n    position_count = Math.min(positions_in_group.length, 4);\n    area_height = Math.round((bottom - top) / position_count);\n    area_top = top;\n    i = 0;\n    while (i < position_count) {\n      position = positions_in_group[i];\n\n      sub = 0;\n/*\n      if(this.current_node.is_open && position.node.getNextSibling()) {\n        if(position.node.getNextSibling() == this.current_node) {\n          console.log(\"A\");\n          sub = this.current_node.element.offsetHeight / 2;\n        }\n        else if(position.node == this.current_node.parent) {\n          console.log(\"B\");\n          sub = this.current_node.parent.element.offsetHeight / 2;\n        }\n        else if(position.node == this.current_node.parent.parent) {\n          console.log(\"C\");\n          sub = this.current_node.parent.parent.element.offsetHeight / 2;\n        }\n      }\n\n      if(position.node.id == 4) {\n        console.log(area_top + \" + \" + area_height + \" - \" + sub + \" = \" + (area_top + area_height - sub));\n        // console.log(position.node.name + \" - \" + sub);\n      }\n*/\n\n      hit_areas.push({\n        top: area_top,\n        bottom: area_top + area_height - sub,\n        node: position.node,\n        position: position.position\n      });\n      area_top += area_height;\n      i += 1;\n    }\n    return null;\n  };\n\n  return HitAreasGenerator;\n\n})(VisibleNodeIterator);\n\nDragElement = (function() {\n  function DragElement(node, offset_x, offset_y, $tree) {\n    this.offset_x = offset_x;\n    this.offset_y = offset_y;\n    this.$element = $(\"<span class=\\\"jqtree-title jqtree-dragging\\\">\" + node.name + \"</span>\");\n    this.$element.css(\"position\", \"absolute\");\n    $tree.append(this.$element);\n  }\n\n  DragElement.prototype.move = function(page_x, page_y) {\n    return this.$element.offset({\n      left: page_x - this.offset_x,\n      top: page_y - this.offset_y\n    });\n  };\n\n  DragElement.prototype.remove = function() {\n    return this.$element.remove();\n  };\n\n  return DragElement;\n\n})();\n\nmodule.exports = {\n  DragAndDropHandler: DragAndDropHandler,\n  DragElement: DragElement,\n  HitAreasGenerator: HitAreasGenerator\n};\n\n},{\"./node\":5}],2:[function(require,module,exports){\nvar $, ElementsRenderer, NodeElement, html_escape, node_element, util;\n\nnode_element = require('./node_element');\n\nNodeElement = node_element.NodeElement;\n\nutil = require('./util');\n\nhtml_escape = util.html_escape;\n\n$ = jQuery;\n\nElementsRenderer = (function() {\n  function ElementsRenderer(tree_widget) {\n    this.tree_widget = tree_widget;\n    this.opened_icon_element = this.createButtonElement(tree_widget.options.openedIcon);\n    this.closed_icon_element = this.createButtonElement(tree_widget.options.closedIcon);\n  }\n\n  ElementsRenderer.prototype.render = function(from_node) {\n    if (from_node && from_node.parent) {\n      return this.renderFromNode(from_node);\n    } else {\n      return this.renderFromRoot();\n    }\n  };\n\n  ElementsRenderer.prototype.renderFromRoot = function() {\n    var $element;\n    $element = this.tree_widget.element;\n    $element.empty();\n    return this.createDomElements($element[0], this.tree_widget.tree.children, true, true, 1);\n  };\n\n  ElementsRenderer.prototype.renderFromNode = function(node) {\n    var $previous_li, li;\n    $previous_li = $(node.element);\n    li = this.createLi(node);\n    this.attachNodeData(node, li);\n    $previous_li.after(li);\n    $previous_li.remove();\n    if (node.children) {\n      return this.createDomElements(li, node.children, false, false, node.getLevel());\n    }\n  };\n\n  ElementsRenderer.prototype.createDomElements = function(element, children, is_root_node, is_open, level) {\n    var child, i, len, li, ul;\n    ul = this.createUl(is_root_node);\n    element.appendChild(ul);\n    for (i = 0, len = children.length; i < len; i++) {\n      child = children[i];\n      li = this.createLi(child, level);\n      ul.appendChild(li);\n      this.attachNodeData(child, li);\n      if (child.hasChildren()) {\n        this.createDomElements(li, child.children, false, child.is_open, level + 1);\n      }\n    }\n    return null;\n  };\n\n  ElementsRenderer.prototype.attachNodeData = function(node, li) {\n    node.element = li;\n    return $(li).data('node', node);\n  };\n\n  ElementsRenderer.prototype.createUl = function(is_root_node) {\n    var class_string, role, ul;\n    if (!is_root_node) {\n      class_string = '';\n      role = 'group';\n    } else {\n      class_string = 'jqtree-tree';\n      role = 'tree';\n      if (this.tree_widget.options.rtl) {\n        class_string += ' jqtree-rtl';\n      }\n    }\n    ul = document.createElement('ul');\n    ul.className = \"jqtree_common \" + class_string;\n    ul.setAttribute('role', role);\n    return ul;\n  };\n\n  ElementsRenderer.prototype.createLi = function(node, level) {\n    var is_selected, li;\n    is_selected = this.tree_widget.select_node_handler && this.tree_widget.select_node_handler.isNodeSelected(node);\n    if (node.isFolder()) {\n      li = this.createFolderLi(node, level, is_selected);\n    } else {\n      li = this.createNodeLi(node, level, is_selected);\n    }\n    if (this.tree_widget.options.onCreateLi) {\n      this.tree_widget.options.onCreateLi(node, $(li));\n    }\n    return li;\n  };\n\n  ElementsRenderer.prototype.createFolderLi = function(node, level, is_selected) {\n    var button_classes, button_link, div, folder_classes, icon_element, is_folder, li;\n    button_classes = this.getButtonClasses(node);\n    folder_classes = this.getFolderClasses(node, is_selected);\n    if (node.is_open) {\n      icon_element = this.opened_icon_element;\n    } else {\n      icon_element = this.closed_icon_element;\n    }\n    li = document.createElement('li');\n    li.className = \"jqtree_common \" + folder_classes;\n    li.setAttribute('role', 'presentation');\n    div = document.createElement('div');\n    div.className = \"jqtree-element jqtree_common\";\n    div.setAttribute('role', 'presentation');\n    li.appendChild(div);\n    button_link = document.createElement('a');\n    button_link.className = button_classes;\n    button_link.appendChild(icon_element.cloneNode(false));\n    button_link.setAttribute('role', 'presentation');\n    button_link.setAttribute('aria-hidden', 'true');\n    if (this.tree_widget.options.buttonLeft) {\n      div.appendChild(button_link);\n    }\n    div.appendChild(this.createTitleSpan(node.name, level, is_selected, node.is_open, is_folder = true));\n    if (!this.tree_widget.options.buttonLeft) {\n      div.appendChild(button_link);\n    }\n    return li;\n  };\n\n  ElementsRenderer.prototype.createNodeLi = function(node, level, is_selected) {\n    var class_string, div, is_folder, li, li_classes;\n    li_classes = ['jqtree_common'];\n    if (is_selected) {\n      li_classes.push('jqtree-selected');\n    }\n    class_string = li_classes.join(' ');\n    li = document.createElement('li');\n    li.className = class_string;\n    li.setAttribute('role', 'presentation');\n    div = document.createElement('div');\n    div.className = \"jqtree-element jqtree_common\";\n    div.setAttribute('role', 'presentation');\n    li.appendChild(div);\n    div.appendChild(this.createTitleSpan(node.name, level, is_selected, node.is_open, is_folder = false));\n    return li;\n  };\n\n  ElementsRenderer.prototype.createTitleSpan = function(node_name, level, is_selected, is_open, is_folder) {\n    var classes, title_span;\n    title_span = document.createElement('span');\n    classes = \"jqtree-title jqtree_common\";\n    if (is_folder) {\n      classes += \" jqtree-title-folder\";\n    }\n    title_span.className = classes;\n    title_span.setAttribute('role', 'treeitem');\n    title_span.setAttribute('aria-level', level);\n    title_span.setAttribute('aria-selected', util.getBoolString(is_selected));\n    title_span.setAttribute('aria-expanded', util.getBoolString(is_open));\n    if (is_selected) {\n      title_span.setAttribute('tabindex', 0);\n    }\n    title_span.innerHTML = this.escapeIfNecessary(node_name);\n    return title_span;\n  };\n\n  ElementsRenderer.prototype.getButtonClasses = function(node) {\n    var classes;\n    classes = ['jqtree-toggler', 'jqtree_common'];\n    if (!node.is_open) {\n      classes.push('jqtree-closed');\n    }\n    if (this.tree_widget.options.buttonLeft) {\n      classes.push('jqtree-toggler-left');\n    } else {\n      classes.push('jqtree-toggler-right');\n    }\n    return classes.join(' ');\n  };\n\n  ElementsRenderer.prototype.getFolderClasses = function(node, is_selected) {\n    var classes;\n    classes = ['jqtree-folder'];\n    if (!node.is_open) {\n      classes.push('jqtree-closed');\n    }\n    if (is_selected) {\n      classes.push('jqtree-selected');\n    }\n    if (node.is_loading) {\n      classes.push('jqtree-loading');\n    }\n    return classes.join(' ');\n  };\n\n  ElementsRenderer.prototype.escapeIfNecessary = function(value) {\n    if (this.tree_widget.options.autoEscape) {\n      return html_escape(value);\n    } else {\n      return value;\n    }\n  };\n\n  ElementsRenderer.prototype.createButtonElement = function(value) {\n    var div;\n    if (typeof value === 'string') {\n      div = document.createElement('div');\n      div.innerHTML = value;\n      return document.createTextNode(div.innerHTML);\n    } else {\n      return $(value)[0];\n    }\n  };\n\n  return ElementsRenderer;\n\n})();\n\nmodule.exports = ElementsRenderer;\n\n},{\"./node_element\":6,\"./util\":12}],3:[function(require,module,exports){\nvar $, KeyHandler,\n  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n$ = jQuery;\n\nKeyHandler = (function() {\n  var DOWN, LEFT, RIGHT, UP;\n\n  LEFT = 37;\n\n  UP = 38;\n\n  RIGHT = 39;\n\n  DOWN = 40;\n\n  function KeyHandler(tree_widget) {\n    this.selectNode = bind(this.selectNode, this);\n    this.tree_widget = tree_widget;\n    if (tree_widget.options.keyboardSupport) {\n      $(document).bind('keydown.jqtree', $.proxy(this.handleKeyDown, this));\n    }\n  }\n\n  KeyHandler.prototype.deinit = function() {\n    return $(document).unbind('keydown.jqtree');\n  };\n\n  KeyHandler.prototype.moveDown = function() {\n    var node;\n    node = this.tree_widget.getSelectedNode();\n    if (node) {\n      return this.selectNode(node.getNextNode());\n    } else {\n      return false;\n    }\n  };\n\n  KeyHandler.prototype.moveUp = function() {\n    var node;\n    node = this.tree_widget.getSelectedNode();\n    if (node) {\n      return this.selectNode(node.getPreviousNode());\n    } else {\n      return false;\n    }\n  };\n\n  KeyHandler.prototype.moveRight = function() {\n    var node;\n    node = this.tree_widget.getSelectedNode();\n    if (!node) {\n      return true;\n    } else if (!node.isFolder()) {\n      return true;\n    } else {\n      if (node.is_open) {\n        return this.selectNode(node.getNextNode());\n      } else {\n        this.tree_widget.openNode(node);\n        return false;\n      }\n    }\n  };\n\n  KeyHandler.prototype.moveLeft = function() {\n    var node;\n    node = this.tree_widget.getSelectedNode();\n    if (!node) {\n      return true;\n    } else if (node.isFolder() && node.is_open) {\n      this.tree_widget.closeNode(node);\n      return false;\n    } else {\n      return this.selectNode(node.getParent());\n    }\n  };\n\n  KeyHandler.prototype.handleKeyDown = function(e) {\n    var key;\n    if (!this.tree_widget.options.keyboardSupport) {\n      return true;\n    }\n    if ($(document.activeElement).is('textarea,input,select')) {\n      return true;\n    }\n    if (!this.tree_widget.getSelectedNode()) {\n      return true;\n    }\n    key = e.which;\n    switch (key) {\n      case DOWN:\n        return this.moveDown();\n      case UP:\n        return this.moveUp();\n      case RIGHT:\n        return this.moveRight();\n      case LEFT:\n        return this.moveLeft();\n    }\n    return true;\n  };\n\n  KeyHandler.prototype.selectNode = function(node) {\n    if (!node) {\n      return true;\n    } else {\n      this.tree_widget.selectNode(node);\n      if (this.tree_widget.scroll_handler && (!this.tree_widget.scroll_handler.isScrolledIntoView($(node.element).find('.jqtree-element')))) {\n        this.tree_widget.scrollToNode(node);\n      }\n      return false;\n    }\n  };\n\n  return KeyHandler;\n\n})();\n\nmodule.exports = KeyHandler;\n\n},{}],4:[function(require,module,exports){\n\n/*\nThis widget does the same a the mouse widget in jqueryui.\n */\nvar $, MouseWidget, SimpleWidget,\n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  hasProp = {}.hasOwnProperty;\n\nSimpleWidget = require('./simple.widget');\n\n$ = jQuery;\n\nMouseWidget = (function(superClass) {\n  extend(MouseWidget, superClass);\n\n  function MouseWidget() {\n    return MouseWidget.__super__.constructor.apply(this, arguments);\n  }\n\n  MouseWidget.is_mouse_handled = false;\n\n  MouseWidget.prototype._init = function() {\n    this.$el.bind('mousedown.mousewidget', $.proxy(this._mouseDown, this));\n    this.$el.bind('touchstart.mousewidget', $.proxy(this._touchStart, this));\n    this.is_mouse_started = false;\n    this.mouse_delay = 0;\n    this._mouse_delay_timer = null;\n    this._is_mouse_delay_met = true;\n    return this.mouse_down_info = null;\n  };\n\n  MouseWidget.prototype._deinit = function() {\n    var $document;\n    this.$el.unbind('mousedown.mousewidget');\n    this.$el.unbind('touchstart.mousewidget');\n    $document = $(document);\n    $document.unbind('mousemove.mousewidget');\n    return $document.unbind('mouseup.mousewidget');\n  };\n\n  MouseWidget.prototype._mouseDown = function(e) {\n    var result;\n    if (e.which !== 1) {\n      return;\n    }\n    result = this._handleMouseDown(e, this._getPositionInfo(e));\n    if (result) {\n      e.preventDefault();\n    }\n    return result;\n  };\n\n  MouseWidget.prototype._handleMouseDown = function(e, position_info) {\n    \n    if (MouseWidget.is_mouse_handled) {\n      return;\n    }\n    if (this.is_mouse_started) {\n      this._handleMouseUp(position_info);\n    }\n    this.mouse_down_info = position_info;\n    if (!this._mouseCapture(position_info)) {\n      return;\n    }\n    this._handleStartMouse(e);\n    this.is_mouse_handled = true;\n    return true;\n  };\n\n  MouseWidget.prototype._handleStartMouse = function(e) {\n    var $document;\n    $document = $(document);\n    $document.bind('mousemove.mousewidget', $.proxy(this._mouseMove, this));\n    $document.bind('touchmove.mousewidget', $.proxy(this._touchMove, this));\n    $document.bind('mouseup.mousewidget', $.proxy(this._mouseUp, this));\n    $document.bind('touchend.mousewidget', $.proxy(this._touchEnd, this));\n    if (this.mouse_delay) {\n      return this._startMouseDelayTimer();\n    }\n  };\n\n  MouseWidget.prototype._startMouseDelayTimer = function() {\n    if (this._mouse_delay_timer) {\n      clearTimeout(this._mouse_delay_timer);\n    }\n    this._mouse_delay_timer = setTimeout((function(_this) {\n      return function() {\n        return _this._is_mouse_delay_met = true;\n      };\n    })(this), this.mouse_delay);\n    return this._is_mouse_delay_met = false;\n  };\n\n  MouseWidget.prototype._mouseMove = function(e) {\n    return this._handleMouseMove(e, this._getPositionInfo(e));\n  };\n\n  MouseWidget.prototype._handleMouseMove = function(e, position_info) {\n    if (this.is_mouse_started) {\n      this._mouseDrag(position_info);\n      return e.preventDefault();\n    }\n    if (this.mouse_delay && !this._is_mouse_delay_met) {\n      return true;\n    }\n    this.is_mouse_started = this._mouseStart(this.mouse_down_info) !== false;\n    if (this.is_mouse_started) {\n      this._mouseDrag(position_info);\n    } else {\n      this._handleMouseUp(position_info);\n    }\n    return !this.is_mouse_started;\n  };\n\n  MouseWidget.prototype._getPositionInfo = function(e) {\n    return {\n      page_x: e.pageX,\n      page_y: e.pageY,\n      target: e.target,\n      original_event: e\n    };\n  };\n\n  MouseWidget.prototype._mouseUp = function(e) {\n    return this._handleMouseUp(this._getPositionInfo(e));\n  };\n\n  MouseWidget.prototype._handleMouseUp = function(position_info) {\n    var $document;\n    $document = $(document);\n    $document.unbind('mousemove.mousewidget');\n    $document.unbind('touchmove.mousewidget');\n    $document.unbind('mouseup.mousewidget');\n    $document.unbind('touchend.mousewidget');\n    if (this.is_mouse_started) {\n      this.is_mouse_started = false;\n      this._mouseStop(position_info);\n    }\n  };\n\n  MouseWidget.prototype._mouseCapture = function(position_info) {\n    return true;\n  };\n\n  MouseWidget.prototype._mouseStart = function(position_info) {\n    return null;\n  };\n\n  MouseWidget.prototype._mouseDrag = function(position_info) {\n    return null;\n  };\n\n  MouseWidget.prototype._mouseStop = function(position_info) {\n    return null;\n  };\n\n  MouseWidget.prototype.setMouseDelay = function(mouse_delay) {\n    return this.mouse_delay = mouse_delay;\n  };\n\n  MouseWidget.prototype._touchStart = function(e) {\n    var touch;\n    if (e.originalEvent.touches.length > 1) {\n      return;\n    }\n    touch = e.originalEvent.changedTouches[0];\n    return this._handleMouseDown(e, this._getPositionInfo(touch));\n  };\n\n  MouseWidget.prototype._touchMove = function(e) {\n    var touch;\n                e.preventDefault();\n    if (e.originalEvent.touches.length > 1) {\n      return;\n    }\n    touch = e.originalEvent.changedTouches[0];\n    return this._handleMouseMove(e, this._getPositionInfo(touch));\n  };\n\n  MouseWidget.prototype._touchEnd = function(e) {\n    var touch;\n    if (e.originalEvent.touches.length > 1) {\n      return;\n    }\n    touch = e.originalEvent.changedTouches[0];\n    return this._handleMouseUp(this._getPositionInfo(touch));\n  };\n\n  return MouseWidget;\n\n})(SimpleWidget);\n\nmodule.exports = MouseWidget;\n\n},{\"./simple.widget\":10}],5:[function(require,module,exports){\nvar $, Node, Position;\n\n$ = jQuery;\n\nPosition = {\n  getName: function(position) {\n    return Position.strings[position - 1];\n  },\n  nameToIndex: function(name) {\n    var i, j, ref;\n    for (i = j = 1, ref = Position.strings.length; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n      if (Position.strings[i - 1] === name) {\n        return i;\n      }\n    }\n    return 0;\n  }\n};\n\nPosition.BEFORE = 1;\n\nPosition.AFTER = 2;\n\nPosition.INSIDE = 3;\n\nPosition.NONE = 4;\n\nPosition.strings = ['before', 'after', 'inside', 'none'];\n\nNode = (function() {\n  function Node(o, is_root, node_class) {\n    if (is_root == null) {\n      is_root = false;\n    }\n    if (node_class == null) {\n      node_class = Node;\n    }\n    this.name = '';\n    this.setData(o);\n    this.children = [];\n    this.parent = null;\n    if (is_root) {\n      this.id_mapping = {};\n      this.tree = this;\n      this.node_class = node_class;\n    }\n  }\n\n  Node.prototype.setData = function(o) {\n    var key, setName, value;\n    setName = (function(_this) {\n      return function(name) {\n        if (name !== null) {\n          return _this.name = name;\n        }\n      };\n    })(this);\n    if (typeof o !== 'object') {\n      setName(o);\n    } else {\n      for (key in o) {\n        value = o[key];\n        if (key === 'label') {\n          setName(value);\n        } else {\n          this[key] = value;\n        }\n      }\n    }\n    return null;\n  };\n\n  Node.prototype.initFromData = function(data) {\n    var addChildren, addNode;\n    addNode = (function(_this) {\n      return function(node_data) {\n        _this.setData(node_data);\n        if (node_data.children) {\n          return addChildren(node_data.children);\n        }\n      };\n    })(this);\n    addChildren = (function(_this) {\n      return function(children_data) {\n        var child, j, len, node;\n        for (j = 0, len = children_data.length; j < len; j++) {\n          child = children_data[j];\n          node = new _this.tree.node_class('');\n          node.initFromData(child);\n          _this.addChild(node);\n        }\n        return null;\n      };\n    })(this);\n    addNode(data);\n    return null;\n  };\n\n\n  /*\n  Create tree from data.\n  \n  Structure of data is:\n  [\n      {\n          label: 'node1',\n          children: [\n              { label: 'child1' },\n              { label: 'child2' }\n          ]\n      },\n      {\n          label: 'node2'\n      }\n  ]\n   */\n\n  Node.prototype.loadFromData = function(data) {\n    var j, len, node, o;\n    this.removeChildren();\n    for (j = 0, len = data.length; j < len; j++) {\n      o = data[j];\n      node = new this.tree.node_class(o);\n      this.addChild(node);\n      if (typeof o === 'object' && o.children) {\n        node.loadFromData(o.children);\n      }\n    }\n    return null;\n  };\n\n\n  /*\n  Add child.\n  \n  tree.addChild(\n      new Node('child1')\n  );\n   */\n\n  Node.prototype.addChild = function(node) {\n    this.children.push(node);\n    return node._setParent(this);\n  };\n\n\n  /*\n  Add child at position. Index starts at 0.\n  \n  tree.addChildAtPosition(\n      new Node('abc'),\n      1\n  );\n   */\n\n  Node.prototype.addChildAtPosition = function(node, index) {\n    this.children.splice(index, 0, node);\n    return node._setParent(this);\n  };\n\n  Node.prototype._setParent = function(parent) {\n    this.parent = parent;\n    this.tree = parent.tree;\n    return this.tree.addNodeToIndex(this);\n  };\n\n\n  /*\n  Remove child. This also removes the children of the node.\n  \n  tree.removeChild(tree.children[0]);\n   */\n\n  Node.prototype.removeChild = function(node) {\n    node.removeChildren();\n    return this._removeChild(node);\n  };\n\n  Node.prototype._removeChild = function(node) {\n    this.children.splice(this.getChildIndex(node), 1);\n    return this.tree.removeNodeFromIndex(node);\n  };\n\n\n  /*\n  Get child index.\n  \n  var index = getChildIndex(node);\n   */\n\n  Node.prototype.getChildIndex = function(node) {\n    return $.inArray(node, this.children);\n  };\n\n\n  /*\n  Does the tree have children?\n  \n  if (tree.hasChildren()) {\n      //\n  }\n   */\n\n  Node.prototype.hasChildren = function() {\n    return this.children.length !== 0;\n  };\n\n  Node.prototype.isFolder = function() {\n    return this.hasChildren() || this.load_on_demand;\n  };\n\n\n  /*\n  Iterate over all the nodes in the tree.\n  \n  Calls callback with (node, level).\n  \n  The callback must return true to continue the iteration on current node.\n  \n  tree.iterate(\n      function(node, level) {\n         console.log(node.name);\n  \n         // stop iteration after level 2\n         return (level <= 2);\n      }\n  );\n   */\n\n  Node.prototype.iterate = function(callback) {\n    var _iterate;\n    _iterate = function(node, level) {\n      var child, j, len, ref, result;\n      if (node.children) {\n        ref = node.children;\n        for (j = 0, len = ref.length; j < len; j++) {\n          child = ref[j];\n          result = callback(child, level);\n          if (result && child.hasChildren()) {\n            _iterate(child, level + 1);\n          }\n        }\n        return null;\n      }\n    };\n    _iterate(this, 0);\n    return null;\n  };\n\n\n  /*\n  Move node relative to another node.\n  \n  Argument position: Position.BEFORE, Position.AFTER or Position.Inside\n  \n  // move node1 after node2\n  tree.moveNode(node1, node2, Position.AFTER);\n   */\n\n  Node.prototype.moveNode = function(moved_node, target_node, position) {\n    if (moved_node.isParentOf(target_node)) {\n      return;\n    }\n    moved_node.parent._removeChild(moved_node);\n    if (position === Position.AFTER) {\n      return target_node.parent.addChildAtPosition(moved_node, target_node.parent.getChildIndex(target_node) + 1);\n    } else if (position === Position.BEFORE) {\n      return target_node.parent.addChildAtPosition(moved_node, target_node.parent.getChildIndex(target_node));\n    } else if (position === Position.INSIDE) {\n      return target_node.addChildAtPosition(moved_node, 0);\n    }\n  };\n\n\n  /*\n  Get the tree as data.\n   */\n\n  Node.prototype.getData = function(include_parent) {\n    var getDataFromNodes;\n    if (include_parent == null) {\n      include_parent = false;\n    }\n    getDataFromNodes = function(nodes) {\n      var data, j, k, len, node, tmp_node, v;\n      data = [];\n      for (j = 0, len = nodes.length; j < len; j++) {\n        node = nodes[j];\n        tmp_node = {};\n        for (k in node) {\n          v = node[k];\n          if ((k !== 'parent' && k !== 'children' && k !== 'element' && k !== 'tree') && Object.prototype.hasOwnProperty.call(node, k)) {\n            tmp_node[k] = v;\n          }\n        }\n        if (node.hasChildren()) {\n          tmp_node.children = getDataFromNodes(node.children);\n        }\n        data.push(tmp_node);\n      }\n      return data;\n    };\n    if (include_parent) {\n      return getDataFromNodes([this]);\n    } else {\n      return getDataFromNodes(this.children);\n    }\n  };\n\n  Node.prototype.getNodeByName = function(name) {\n    var result;\n    result = null;\n    this.iterate(function(node) {\n      if (node.name === name) {\n        result = node;\n        return false;\n      } else {\n        return true;\n      }\n    });\n    return result;\n  };\n\n  Node.prototype.addAfter = function(node_info) {\n    var child_index, node;\n    if (!this.parent) {\n      return null;\n    } else {\n      node = new this.tree.node_class(node_info);\n      child_index = this.parent.getChildIndex(this);\n      this.parent.addChildAtPosition(node, child_index + 1);\n      return node;\n    }\n  };\n\n  Node.prototype.addBefore = function(node_info) {\n    var child_index, node;\n    if (!this.parent) {\n      return null;\n    } else {\n      node = new this.tree.node_class(node_info);\n      child_index = this.parent.getChildIndex(this);\n      this.parent.addChildAtPosition(node, child_index);\n      return node;\n    }\n  };\n\n  Node.prototype.addParent = function(node_info) {\n    var child, j, len, new_parent, original_parent, ref;\n    if (!this.parent) {\n      return null;\n    } else {\n      new_parent = new this.tree.node_class(node_info);\n      new_parent._setParent(this.tree);\n      original_parent = this.parent;\n      ref = original_parent.children;\n      for (j = 0, len = ref.length; j < len; j++) {\n        child = ref[j];\n        new_parent.addChild(child);\n      }\n      original_parent.children = [];\n      original_parent.addChild(new_parent);\n      return new_parent;\n    }\n  };\n\n  Node.prototype.remove = function() {\n    if (this.parent) {\n      this.parent.removeChild(this);\n      return this.parent = null;\n    }\n  };\n\n  Node.prototype.append = function(node_info) {\n    var node;\n    node = new this.tree.node_class(node_info);\n    this.addChild(node);\n    return node;\n  };\n\n  Node.prototype.prepend = function(node_info) {\n    var node;\n    node = new this.tree.node_class(node_info);\n    this.addChildAtPosition(node, 0);\n    return node;\n  };\n\n  Node.prototype.isParentOf = function(node) {\n    var parent;\n    parent = node.parent;\n    while (parent) {\n      if (parent === this) {\n        return true;\n      }\n      parent = parent.parent;\n    }\n    return false;\n  };\n\n  Node.prototype.getLevel = function() {\n    var level, node;\n    level = 0;\n    node = this;\n    while (node.parent) {\n      level += 1;\n      node = node.parent;\n    }\n    return level;\n  };\n\n  Node.prototype.getNodeById = function(node_id) {\n    return this.id_mapping[node_id];\n  };\n\n  Node.prototype.addNodeToIndex = function(node) {\n    if (node.id != null) {\n      return this.id_mapping[node.id] = node;\n    }\n  };\n\n  Node.prototype.removeNodeFromIndex = function(node) {\n    if (node.id != null) {\n      return delete this.id_mapping[node.id];\n    }\n  };\n\n  Node.prototype.removeChildren = function() {\n    this.iterate((function(_this) {\n      return function(child) {\n        _this.tree.removeNodeFromIndex(child);\n        return true;\n      };\n    })(this));\n    return this.children = [];\n  };\n\n  Node.prototype.getPreviousSibling = function() {\n    var previous_index;\n    if (!this.parent) {\n      return null;\n    } else {\n      previous_index = this.parent.getChildIndex(this) - 1;\n      if (previous_index >= 0) {\n        return this.parent.children[previous_index];\n      } else {\n        return null;\n      }\n    }\n  };\n\n  Node.prototype.getNextSibling = function() {\n    var next_index;\n    if (!this.parent) {\n      return null;\n    } else {\n      next_index = this.parent.getChildIndex(this) + 1;\n      if (next_index < this.parent.children.length) {\n        return this.parent.children[next_index];\n      } else {\n        return null;\n      }\n    }\n  };\n\n  Node.prototype.getNodesByProperty = function(key, value) {\n    return this.filter(function(node) {\n      return node[key] === value;\n    });\n  };\n\n  Node.prototype.filter = function(f) {\n    var result;\n    result = [];\n    this.iterate(function(node) {\n      if (f(node)) {\n        result.push(node);\n      }\n      return true;\n    });\n    return result;\n  };\n\n  Node.prototype.getNextNode = function(include_children) {\n    var next_sibling;\n    if (include_children == null) {\n      include_children = true;\n    }\n    if (include_children && this.hasChildren() && this.is_open) {\n      return this.children[0];\n    } else {\n      if (!this.parent) {\n        return null;\n      } else {\n        next_sibling = this.getNextSibling();\n        if (next_sibling) {\n          return next_sibling;\n        } else {\n          return this.parent.getNextNode(false);\n        }\n      }\n    }\n  };\n\n  Node.prototype.getPreviousNode = function() {\n    var previous_sibling;\n    if (!this.parent) {\n      return null;\n    } else {\n      previous_sibling = this.getPreviousSibling();\n      if (previous_sibling) {\n        if (!previous_sibling.hasChildren() || !previous_sibling.is_open) {\n          return previous_sibling;\n        } else {\n          return previous_sibling.getLastChild();\n        }\n      } else {\n        return this.getParent();\n      }\n    }\n  };\n\n  Node.prototype.getParent = function() {\n    if (!this.parent) {\n      return null;\n    } else if (!this.parent.parent) {\n      return null;\n    } else {\n      return this.parent;\n    }\n  };\n\n  Node.prototype.getLastChild = function() {\n    var last_child;\n    if (!this.hasChildren()) {\n      return null;\n    } else {\n      last_child = this.children[this.children.length - 1];\n      if (!last_child.hasChildren() || !last_child.is_open) {\n        return last_child;\n      } else {\n        return last_child.getLastChild();\n      }\n    }\n  };\n\n  return Node;\n\n})();\n\nmodule.exports = {\n  Node: Node,\n  Position: Position\n};\n\n},{}],6:[function(require,module,exports){\nvar $, BorderDropHint, FolderElement, GhostDropHint, NodeElement, Position, node,\n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  hasProp = {}.hasOwnProperty;\n\nnode = require('./node');\n\nPosition = node.Position;\n\n$ = jQuery;\n\nNodeElement = (function() {\n  function NodeElement(node, tree_widget) {\n    this.init(node, tree_widget);\n  }\n\n  NodeElement.prototype.init = function(node, tree_widget) {\n    this.node = node;\n    this.tree_widget = tree_widget;\n    if (!node.element) {\n      node.element = this.tree_widget.element;\n    }\n    return this.$element = $(node.element);\n  };\n\n  NodeElement.prototype.getUl = function() {\n    return this.$element.children('ul:first');\n  };\n\n  NodeElement.prototype.getSpan = function() {\n    return this.$element.children('.jqtree-element').find('span.jqtree-title');\n  };\n\n  NodeElement.prototype.getLi = function() {\n    return this.$element;\n  };\n\n  NodeElement.prototype.addDropHint = function(position) {\n    if (position === Position.INSIDE) {\n      return new BorderDropHint(this.$element);\n    } else {\n      return new GhostDropHint(this.node, this.$element, position);\n    }\n  };\n\n  NodeElement.prototype.select = function() {\n    var $li, $span;\n    $li = this.getLi();\n    $li.addClass('jqtree-selected');\n    $li.attr('aria-selected', 'true');\n    $span = this.getSpan();\n    return $span.attr('tabindex', 0);\n  };\n\n  NodeElement.prototype.deselect = function() {\n    var $li, $span;\n    $li = this.getLi();\n    $li.removeClass('jqtree-selected');\n    $li.attr('aria-selected', 'false');\n    $span = this.getSpan();\n    return $span.attr('tabindex', -1);\n  };\n\n  return NodeElement;\n\n})();\n\nFolderElement = (function(superClass) {\n  extend(FolderElement, superClass);\n\n  function FolderElement() {\n    return FolderElement.__super__.constructor.apply(this, arguments);\n  }\n\n  FolderElement.prototype.open = function(on_finished, slide) {\n    var $button, doOpen;\n    if (slide == null) {\n      slide = true;\n    }\n    if (!this.node.is_open) {\n      this.node.is_open = true;\n      $button = this.getButton();\n      $button.removeClass('jqtree-closed');\n      $button.html('');\n      $button.append(this.tree_widget.renderer.opened_icon_element.cloneNode(false));\n      doOpen = (function(_this) {\n        return function() {\n          var $li, $span;\n          $li = _this.getLi();\n          $li.removeClass('jqtree-closed');\n          $span = _this.getSpan();\n          $span.attr('aria-expanded', 'true');\n          if (on_finished) {\n            on_finished();\n          }\n          return _this.tree_widget._triggerEvent('tree.open', {\n            node: _this.node\n          });\n        };\n      })(this);\n      if (slide) {\n        return this.getUl().slideDown('fast', doOpen);\n      } else {\n        this.getUl().show();\n        return doOpen();\n      }\n    }\n  };\n\n  FolderElement.prototype.close = function(slide) {\n    var $button, doClose;\n    if (slide == null) {\n      slide = true;\n    }\n    if (this.node.is_open) {\n      this.node.is_open = false;\n      $button = this.getButton();\n      $button.addClass('jqtree-closed');\n      $button.html('');\n      $button.append(this.tree_widget.renderer.closed_icon_element.cloneNode(false));\n      doClose = (function(_this) {\n        return function() {\n          var $li, $span;\n          $li = _this.getLi();\n          $li.addClass('jqtree-closed');\n          $span = _this.getSpan();\n          $span.attr('aria-expanded', 'false');\n          return _this.tree_widget._triggerEvent('tree.close', {\n            node: _this.node\n          });\n        };\n      })(this);\n      if (slide) {\n        return this.getUl().slideUp('fast', doClose);\n      } else {\n        this.getUl().hide();\n        return doClose();\n      }\n    }\n  };\n\n  FolderElement.prototype.getButton = function() {\n    return this.$element.children('.jqtree-element').find('a.jqtree-toggler');\n  };\n\n  FolderElement.prototype.addDropHint = function(position) {\n    if ((!this.node.is_open || this.tree_widget.dnd_handler.current_item.node.parent.id != this.node.id) && position === Position.INSIDE) {\n      return new BorderDropHint(this.$element);\n    } else {\n      return new GhostDropHint(this.node, this.$element, position);\n    }\n  };\n\n  return FolderElement;\n\n})(NodeElement);\n\nBorderDropHint = (function() {\n  function BorderDropHint($element) {\n    var $div, width;\n    $div = $element.children('.jqtree-element');\n    width = $element.width() - 4;\n    this.$hint = $('<span class=\"jqtree-border\"></span>');\n    $div.append(this.$hint);\n    this.$hint.css({\n      width: width,\n      height: $div.outerHeight() - 4\n    });\n  }\n\n  BorderDropHint.prototype.remove = function() {\n    return this.$hint.remove();\n  };\n\n  return BorderDropHint;\n\n})();\n\nGhostDropHint = (function() {\n  function GhostDropHint(node, $element, position) {\n    this.$element = $element;\n    this.node = node;\n    this.$ghost = $('<li class=\"jqtree_common jqtree-ghost\"><span class=\"jqtree_common jqtree-circle\"></span><span class=\"jqtree_common jqtree-line\"></span></li>');\n    if (position === Position.AFTER) {\n      this.moveAfter();\n    } else if (position === Position.BEFORE) {\n      this.moveBefore();\n    } else if (position === Position.INSIDE) {\n      if (node.isFolder() && node.is_open) {\n        this.moveInsideOpenFolder();\n      } else {\n        this.moveInside();\n      }\n    }\n  }\n\n  GhostDropHint.prototype.remove = function() {\n    return this.$ghost.remove();\n  };\n\n  GhostDropHint.prototype.moveAfter = function() {\n    return this.$element.after(this.$ghost);\n  };\n\n  GhostDropHint.prototype.moveBefore = function() {\n    return this.$element.before(this.$ghost);\n  };\n\n  GhostDropHint.prototype.moveInsideOpenFolder = function() {\n    return $(this.node.children[0].element).before(this.$ghost);\n  };\n\n  GhostDropHint.prototype.moveInside = function() {\n    this.$element.after(this.$ghost);\n    return this.$ghost.addClass('jqtree-inside');\n  };\n\n  return GhostDropHint;\n\n})();\n\nmodule.exports = {\n  BorderDropHint: BorderDropHint,\n  FolderElement: FolderElement,\n  GhostDropHint: GhostDropHint,\n  NodeElement: NodeElement\n};\n\n},{\"./node\":5}],7:[function(require,module,exports){\nvar $, SaveStateHandler, indexOf, isInt, util;\n\nutil = require('./util');\n\nindexOf = util.indexOf;\n\nisInt = util.isInt;\n\n$ = jQuery;\n\nSaveStateHandler = (function() {\n  function SaveStateHandler(tree_widget) {\n    this.tree_widget = tree_widget;\n  }\n\n  SaveStateHandler.prototype.saveState = function() {\n    var state;\n    state = JSON.stringify(this.getState());\n    if (this.tree_widget.options.onSetStateFromStorage) {\n      return this.tree_widget.options.onSetStateFromStorage(state);\n    } else if (this.supportsLocalStorage()) {\n      return localStorage.setItem(this.getCookieName(), state);\n    } else if ($.cookie) {\n      $.cookie.raw = true;\n      return $.cookie(this.getCookieName(), state, {\n        path: '/'\n      });\n    }\n  };\n\n  SaveStateHandler.prototype.getStateFromStorage = function() {\n    var json_data;\n    json_data = this._loadFromStorage();\n    if (json_data) {\n      return this._parseState(json_data);\n    } else {\n      return null;\n    }\n  };\n\n  SaveStateHandler.prototype._parseState = function(json_data) {\n    var state;\n    state = $.parseJSON(json_data);\n    if (state && state.selected_node && isInt(state.selected_node)) {\n      state.selected_node = [state.selected_node];\n    }\n    return state;\n  };\n\n  SaveStateHandler.prototype._loadFromStorage = function() {\n    if (this.tree_widget.options.onGetStateFromStorage) {\n      return this.tree_widget.options.onGetStateFromStorage();\n    } else if (this.supportsLocalStorage()) {\n      return localStorage.getItem(this.getCookieName());\n    } else if ($.cookie) {\n      $.cookie.raw = true;\n      return $.cookie(this.getCookieName());\n    } else {\n      return null;\n    }\n  };\n\n  SaveStateHandler.prototype.getState = function() {\n    var getOpenNodeIds, getSelectedNodeIds;\n    getOpenNodeIds = (function(_this) {\n      return function() {\n        var open_nodes;\n        open_nodes = [];\n        _this.tree_widget.tree.iterate(function(node) {\n          if (node.is_open && node.id && node.hasChildren()) {\n            open_nodes.push(node.id);\n          }\n          return true;\n        });\n        return open_nodes;\n      };\n    })(this);\n    getSelectedNodeIds = (function(_this) {\n      return function() {\n        var n;\n        return (function() {\n          var i, len, ref, results;\n          ref = this.tree_widget.getSelectedNodes();\n          results = [];\n          for (i = 0, len = ref.length; i < len; i++) {\n            n = ref[i];\n            results.push(n.id);\n          }\n          return results;\n        }).call(_this);\n      };\n    })(this);\n    return {\n      open_nodes: getOpenNodeIds(),\n      selected_node: getSelectedNodeIds()\n    };\n  };\n\n  SaveStateHandler.prototype.setInitialState = function(state) {\n    var must_load_on_demand;\n    if (!state) {\n      return false;\n    } else {\n      must_load_on_demand = this._openInitialNodes(state.open_nodes);\n      this._selectInitialNodes(state.selected_node);\n      return must_load_on_demand;\n    }\n  };\n\n  SaveStateHandler.prototype._openInitialNodes = function(node_ids) {\n    var i, len, must_load_on_demand, node, node_id;\n    must_load_on_demand = false;\n    for (i = 0, len = node_ids.length; i < len; i++) {\n      node_id = node_ids[i];\n      node = this.tree_widget.getNodeById(node_id);\n      if (node) {\n        if (!node.load_on_demand) {\n          node.is_open = true;\n        } else {\n          must_load_on_demand = true;\n        }\n      }\n    }\n    return must_load_on_demand;\n  };\n\n  SaveStateHandler.prototype._selectInitialNodes = function(node_ids) {\n    var i, len, node, node_id, select_count;\n    select_count = 0;\n    for (i = 0, len = node_ids.length; i < len; i++) {\n      node_id = node_ids[i];\n      node = this.tree_widget.getNodeById(node_id);\n      if (node) {\n        select_count += 1;\n        this.tree_widget.select_node_handler.addToSelection(node);\n      }\n    }\n    return select_count !== 0;\n  };\n\n  SaveStateHandler.prototype.setInitialStateOnDemand = function(state, cb_finished) {\n    if (state) {\n      return this._setInitialStateOnDemand(state.open_nodes, state.selected_node, cb_finished);\n    } else {\n      return cb_finished();\n    }\n  };\n\n  SaveStateHandler.prototype._setInitialStateOnDemand = function(node_ids, selected_nodes, cb_finished) {\n    var loadAndOpenNode, loading_count, openNodes;\n    loading_count = 0;\n    openNodes = (function(_this) {\n      return function() {\n        var i, len, new_nodes_ids, node, node_id;\n        new_nodes_ids = [];\n        for (i = 0, len = node_ids.length; i < len; i++) {\n          node_id = node_ids[i];\n          node = _this.tree_widget.getNodeById(node_id);\n          if (!node) {\n            new_nodes_ids.push(node_id);\n          } else {\n            if (!node.is_loading) {\n              if (node.load_on_demand) {\n                loadAndOpenNode(node);\n              } else {\n                _this.tree_widget._openNode(node, false);\n              }\n            }\n          }\n        }\n        node_ids = new_nodes_ids;\n        if (_this._selectInitialNodes(selected_nodes)) {\n          _this.tree_widget._refreshElements();\n        }\n        if (loading_count === 0) {\n          return cb_finished();\n        }\n      };\n    })(this);\n    loadAndOpenNode = (function(_this) {\n      return function(node) {\n        loading_count += 1;\n        return _this.tree_widget._openNode(node, false, function() {\n          loading_count -= 1;\n          return openNodes();\n        });\n      };\n    })(this);\n    return openNodes();\n  };\n\n  SaveStateHandler.prototype.getCookieName = function() {\n    if (typeof this.tree_widget.options.saveState === 'string') {\n      return this.tree_widget.options.saveState;\n    } else {\n      return 'tree';\n    }\n  };\n\n  SaveStateHandler.prototype.supportsLocalStorage = function() {\n    var testSupport;\n    testSupport = function() {\n      var error, error1, key;\n      if (typeof localStorage === \"undefined\" || localStorage === null) {\n        return false;\n      } else {\n        try {\n          key = '_storage_test';\n          sessionStorage.setItem(key, true);\n          sessionStorage.removeItem(key);\n        } catch (error1) {\n          error = error1;\n          return false;\n        }\n        return true;\n      }\n    };\n    if (this._supportsLocalStorage == null) {\n      this._supportsLocalStorage = testSupport();\n    }\n    return this._supportsLocalStorage;\n  };\n\n  SaveStateHandler.prototype.getNodeIdToBeSelected = function() {\n    var state;\n    state = this.getStateFromStorage();\n    if (state && state.selected_node) {\n      return state.selected_node[0];\n    } else {\n      return null;\n    }\n  };\n\n  return SaveStateHandler;\n\n})();\n\nmodule.exports = SaveStateHandler;\n\n},{\"./util\":12}],8:[function(require,module,exports){\nvar $, ScrollHandler;\n\n$ = jQuery;\n\nScrollHandler = (function() {\n  function ScrollHandler(tree_widget) {\n    this.tree_widget = tree_widget;\n    this.previous_top = -1;\n    this.is_initialized = false;\n    this._initScrollParent();\n  }\n\n  ScrollHandler.prototype._initScrollParent = function() {\n    var $scroll_parent, getParentWithOverflow, setDocumentAsScrollParent;\n    getParentWithOverflow = (function(_this) {\n      return function() {\n        var css_values, el, hasOverFlow, i, len, ref;\n        css_values = ['overflow', 'overflow-y'];\n        hasOverFlow = function(el) {\n          var css_value, i, len, ref;\n          for (i = 0, len = css_values.length; i < len; i++) {\n            css_value = css_values[i];\n            if ((ref = $.css(el, css_value)) === 'auto' || ref === 'scroll') {\n              return true;\n            }\n          }\n          return false;\n        };\n        if (hasOverFlow(_this.tree_widget.$el[0])) {\n          return _this.tree_widget.$el;\n        }\n        ref = _this.tree_widget.$el.parents();\n        for (i = 0, len = ref.length; i < len; i++) {\n          el = ref[i];\n          if (hasOverFlow(el)) {\n            return $(el);\n          }\n        }\n        return null;\n      };\n    })(this);\n    setDocumentAsScrollParent = (function(_this) {\n      return function() {\n        _this.scroll_parent_top = 0;\n        return _this.$scroll_parent = null;\n      };\n    })(this);\n    if (this.tree_widget.$el.css('position') === 'fixed') {\n      setDocumentAsScrollParent();\n    }\n    $scroll_parent = getParentWithOverflow();\n    if ($scroll_parent && $scroll_parent.length && $scroll_parent[0].tagName !== 'HTML') {\n      this.$scroll_parent = $scroll_parent;\n      this.scroll_parent_top = this.$scroll_parent.offset().top;\n    } else {\n      setDocumentAsScrollParent();\n    }\n    return this.is_initialized = true;\n  };\n\n  ScrollHandler.prototype._ensureInit = function() {\n    if (!this.is_initialized) {\n      return this._initScrollParent();\n    }\n  };\n\n  ScrollHandler.prototype.checkScrolling = function() {\n    var hovered_area;\n    this._ensureInit();\n    hovered_area = this.tree_widget.dnd_handler.hovered_area;\n    if (hovered_area && hovered_area.top !== this.previous_top) {\n      this.previous_top = hovered_area.top;\n      if (this.$scroll_parent) {\n        return this._handleScrollingWithScrollParent(hovered_area);\n      } else {\n        return this._handleScrollingWithDocument(hovered_area);\n      }\n    }\n  };\n\n  ScrollHandler.prototype._handleScrollingWithScrollParent = function(area) {\n    var distance_bottom;\n    distance_bottom = this.scroll_parent_top + this.$scroll_parent[0].offsetHeight - area.bottom;\n    if (distance_bottom < 20) {\n      this.$scroll_parent[0].scrollTop += 20;\n      this.tree_widget.refreshHitAreas();\n      return this.previous_top = -1;\n    } else if ((area.top - this.scroll_parent_top) < 20) {\n      this.$scroll_parent[0].scrollTop -= 20;\n      this.tree_widget.refreshHitAreas();\n      return this.previous_top = -1;\n    }\n  };\n\n  ScrollHandler.prototype._handleScrollingWithDocument = function(area) {\n    var distance_top;\n    distance_top = area.top - $(document).scrollTop();\n    if (distance_top < 20) {\n      return $(document).scrollTop($(document).scrollTop() - 20);\n    } else if ($(window).height() - (area.bottom - $(document).scrollTop()) < 20) {\n      return $(document).scrollTop($(document).scrollTop() + 20);\n    }\n  };\n\n  ScrollHandler.prototype.scrollTo = function(top) {\n    var tree_top;\n    this._ensureInit();\n    if (this.$scroll_parent) {\n      return this.$scroll_parent[0].scrollTop = top;\n    } else {\n      tree_top = this.tree_widget.$el.offset().top;\n      return $(document).scrollTop(top + tree_top);\n    }\n  };\n\n  ScrollHandler.prototype.isScrolledIntoView = function(element) {\n    var $element, element_bottom, element_top, view_bottom, view_top;\n    this._ensureInit();\n    $element = $(element);\n    if (this.$scroll_parent) {\n      view_top = 0;\n      view_bottom = this.$scroll_parent.height();\n      element_top = $element.offset().top - this.scroll_parent_top;\n      element_bottom = element_top + $element.height();\n    } else {\n      view_top = $(window).scrollTop();\n      view_bottom = view_top + $(window).height();\n      element_top = $element.offset().top;\n      element_bottom = element_top + $element.height();\n    }\n    return (element_bottom <= view_bottom) && (element_top >= view_top);\n  };\n\n  return ScrollHandler;\n\n})();\n\nmodule.exports = ScrollHandler;\n\n},{}],9:[function(require,module,exports){\nvar $, SelectNodeHandler;\n\n$ = jQuery;\n\nSelectNodeHandler = (function() {\n  function SelectNodeHandler(tree_widget) {\n    this.tree_widget = tree_widget;\n    this.clear();\n  }\n\n  SelectNodeHandler.prototype.getSelectedNode = function() {\n    var selected_nodes;\n    selected_nodes = this.getSelectedNodes();\n    if (selected_nodes.length) {\n      return selected_nodes[0];\n    } else {\n      return false;\n    }\n  };\n\n  SelectNodeHandler.prototype.getSelectedNodes = function() {\n    var id, node, selected_nodes;\n    if (this.selected_single_node) {\n      return [this.selected_single_node];\n    } else {\n      selected_nodes = [];\n      for (id in this.selected_nodes) {\n        node = this.tree_widget.getNodeById(id);\n        if (node) {\n          selected_nodes.push(node);\n        }\n      }\n      return selected_nodes;\n    }\n  };\n\n  SelectNodeHandler.prototype.getSelectedNodesUnder = function(parent) {\n    var id, node, selected_nodes;\n    if (this.selected_single_node) {\n      if (parent.isParentOf(this.selected_single_node)) {\n        return [this.selected_single_node];\n      } else {\n        return [];\n      }\n    } else {\n      selected_nodes = [];\n      for (id in this.selected_nodes) {\n        node = this.tree_widget.getNodeById(id);\n        if (node && parent.isParentOf(node)) {\n          selected_nodes.push(node);\n        }\n      }\n      return selected_nodes;\n    }\n  };\n\n  SelectNodeHandler.prototype.isNodeSelected = function(node) {\n    if (node.id) {\n      return this.selected_nodes[node.id];\n    } else if (this.selected_single_node) {\n      return this.selected_single_node.element === node.element;\n    } else {\n      return false;\n    }\n  };\n\n  SelectNodeHandler.prototype.clear = function() {\n    this.selected_nodes = {};\n    return this.selected_single_node = null;\n  };\n\n  SelectNodeHandler.prototype.removeFromSelection = function(node, include_children) {\n    if (include_children == null) {\n      include_children = false;\n    }\n    if (!node.id) {\n      if (this.selected_single_node && node.element === this.selected_single_node.element) {\n        return this.selected_single_node = null;\n      }\n    } else {\n      delete this.selected_nodes[node.id];\n      if (include_children) {\n        return node.iterate((function(_this) {\n          return function(n) {\n            delete _this.selected_nodes[node.id];\n            return true;\n          };\n        })(this));\n      }\n    }\n  };\n\n  SelectNodeHandler.prototype.addToSelection = function(node) {\n    if (node.id) {\n      return this.selected_nodes[node.id] = true;\n    } else {\n      return this.selected_single_node = node;\n    }\n  };\n\n  return SelectNodeHandler;\n\n})();\n\nmodule.exports = SelectNodeHandler;\n\n},{}],10:[function(require,module,exports){\n\n/*\nCopyright 2013 Marco Braak\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n */\nvar $, SimpleWidget,\n  slice = [].slice;\n\n$ = jQuery;\n\nSimpleWidget = (function() {\n  SimpleWidget.prototype.defaults = {};\n\n  function SimpleWidget(el, options) {\n    this.$el = $(el);\n    this.options = $.extend({}, this.defaults, options);\n  }\n\n  SimpleWidget.prototype.destroy = function() {\n    return this._deinit();\n  };\n\n  SimpleWidget.prototype._init = function() {\n    return null;\n  };\n\n  SimpleWidget.prototype._deinit = function() {\n    return null;\n  };\n\n  SimpleWidget.register = function(widget_class, widget_name) {\n    var callFunction, createWidget, destroyWidget, getDataKey, getWidgetData;\n    getDataKey = function() {\n      return \"simple_widget_\" + widget_name;\n    };\n    getWidgetData = function(el, data_key) {\n      var widget;\n      widget = $.data(el, data_key);\n      if (widget && (widget instanceof SimpleWidget)) {\n        return widget;\n      } else {\n        return null;\n      }\n    };\n    createWidget = function($el, options) {\n      var data_key, el, existing_widget, i, len, widget;\n      data_key = getDataKey();\n      for (i = 0, len = $el.length; i < len; i++) {\n        el = $el[i];\n        existing_widget = getWidgetData(el, data_key);\n        if (!existing_widget) {\n          widget = new widget_class(el, options);\n          if (!$.data(el, data_key)) {\n            $.data(el, data_key, widget);\n          }\n          widget._init();\n        }\n      }\n      return $el;\n    };\n    destroyWidget = function($el) {\n      var data_key, el, i, len, results, widget;\n      data_key = getDataKey();\n      results = [];\n      for (i = 0, len = $el.length; i < len; i++) {\n        el = $el[i];\n        widget = getWidgetData(el, data_key);\n        if (widget) {\n          widget.destroy();\n        }\n        results.push($.removeData(el, data_key));\n      }\n      return results;\n    };\n    callFunction = function($el, function_name, args) {\n      var el, i, len, result, widget, widget_function;\n      result = null;\n      for (i = 0, len = $el.length; i < len; i++) {\n        el = $el[i];\n        widget = $.data(el, getDataKey());\n        if (widget && (widget instanceof SimpleWidget)) {\n          widget_function = widget[function_name];\n          if (widget_function && (typeof widget_function === 'function')) {\n            result = widget_function.apply(widget, args);\n          }\n        }\n      }\n      return result;\n    };\n    return $.fn[widget_name] = function() {\n      var $el, args, argument1, function_name, options;\n      argument1 = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n      $el = this;\n      if (argument1 === void 0 || typeof argument1 === 'object') {\n        options = argument1;\n        return createWidget($el, options);\n      } else if (typeof argument1 === 'string' && argument1[0] !== '_') {\n        function_name = argument1;\n        if (function_name === 'destroy') {\n          return destroyWidget($el);\n        } else if (function_name === 'get_widget_class') {\n          return widget_class;\n        } else {\n          return callFunction($el, function_name, args);\n        }\n      }\n    };\n  };\n\n  return SimpleWidget;\n\n})();\n\nmodule.exports = SimpleWidget;\n\n},{}],11:[function(require,module,exports){\nvar $, BorderDropHint, DragAndDropHandler, DragElement, ElementsRenderer, FolderElement, GhostDropHint, HitAreasGenerator, JqTreeWidget, KeyHandler, MouseWidget, Node, NodeElement, Position, SaveStateHandler, ScrollHandler, SelectNodeHandler, SimpleWidget, __version__, node_module, ref, ref1, util_module,\n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  hasProp = {}.hasOwnProperty;\n\n__version__ = require('./version');\n\nref = require('./drag_and_drop_handler'), DragAndDropHandler = ref.DragAndDropHandler, DragElement = ref.DragElement, HitAreasGenerator = ref.HitAreasGenerator;\n\nElementsRenderer = require('./elements_renderer');\n\nKeyHandler = require('./key_handler');\n\nMouseWidget = require('./mouse.widget');\n\nSaveStateHandler = require('./save_state_handler');\n\nScrollHandler = require('./scroll_handler');\n\nSelectNodeHandler = require('./select_node_handler');\n\nSimpleWidget = require('./simple.widget');\n\nnode_module = require('./node');\n\nNode = node_module.Node;\n\nPosition = node_module.Position;\n\nutil_module = require('./util');\n\nref1 = require('./node_element'), BorderDropHint = ref1.BorderDropHint, FolderElement = ref1.FolderElement, GhostDropHint = ref1.GhostDropHint, NodeElement = ref1.NodeElement;\n\n$ = jQuery;\n\nJqTreeWidget = (function(superClass) {\n  extend(JqTreeWidget, superClass);\n\n  function JqTreeWidget() {\n    return JqTreeWidget.__super__.constructor.apply(this, arguments);\n  }\n\n  JqTreeWidget.prototype.BorderDropHint = BorderDropHint;\n\n  JqTreeWidget.prototype.DragElement = DragElement;\n\n  JqTreeWidget.prototype.DragAndDropHandler = DragAndDropHandler;\n\n  JqTreeWidget.prototype.ElementsRenderer = ElementsRenderer;\n\n  JqTreeWidget.prototype.GhostDropHint = GhostDropHint;\n\n  JqTreeWidget.prototype.HitAreasGenerator = HitAreasGenerator;\n\n  JqTreeWidget.prototype.Node = Node;\n\n  JqTreeWidget.prototype.SaveStateHandler = SaveStateHandler;\n\n  JqTreeWidget.prototype.ScrollHandler = ScrollHandler;\n\n  JqTreeWidget.prototype.SelectNodeHandler = SelectNodeHandler;\n\n  JqTreeWidget.prototype.defaults = {\n    autoOpen: false,\n    saveState: false,\n    dragAndDrop: false,\n    selectable: true,\n    useContextMenu: true,\n    onCanSelectNode: null,\n    onSetStateFromStorage: null,\n    onGetStateFromStorage: null,\n    onCreateLi: null,\n    onIsMoveHandle: null,\n    onCanMove: null,\n    onCanMoveTo: null,\n    onLoadFailed: null,\n    autoEscape: true,\n    dataUrl: null,\n    closedIcon: null,\n    openedIcon: '&#x25bc;',\n    slide: true,\n    nodeClass: Node,\n    dataFilter: null,\n    keyboardSupport: true,\n    openFolderDelay: 500,\n    rtl: null,\n    onDragMove: null,\n    onDragStop: null,\n    buttonLeft: true\n  };\n\n  JqTreeWidget.prototype.toggle = function(node, slide) {\n    if (slide == null) {\n      slide = null;\n    }\n    if (slide === null) {\n      slide = this.options.slide;\n    }\n    if (node.is_open) {\n      this.closeNode(node, slide);\n    } else {\n      this.openNode(node, slide);\n    }\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.getTree = function() {\n    return this.tree;\n  };\n\n  JqTreeWidget.prototype.selectNode = function(node) {\n    this._selectNode(node, false);\n    return this.element;\n  };\n\n  JqTreeWidget.prototype._selectNode = function(node, must_toggle) {\n    var canSelect, deselected_node, openParents, saveState;\n    if (must_toggle == null) {\n      must_toggle = false;\n    }\n    if (!this.select_node_handler) {\n      return;\n    }\n    canSelect = (function(_this) {\n      return function() {\n        if (_this.options.onCanSelectNode) {\n          return _this.options.selectable && _this.options.onCanSelectNode(node);\n        } else {\n          return _this.options.selectable;\n        }\n      };\n    })(this);\n    openParents = (function(_this) {\n      return function() {\n        var parent;\n        parent = node.parent;\n        if (parent && parent.parent && !parent.is_open) {\n          return _this.openNode(parent, false);\n        }\n      };\n    })(this);\n    saveState = (function(_this) {\n      return function() {\n        if (_this.options.saveState) {\n          return _this.save_state_handler.saveState();\n        }\n      };\n    })(this);\n    if (!node) {\n      this._deselectCurrentNode();\n      saveState();\n      return;\n    }\n    if (!canSelect()) {\n      return;\n    }\n    if (this.select_node_handler.isNodeSelected(node)) {\n      if (must_toggle) {\n        this._deselectCurrentNode();\n        this._triggerEvent('tree.select', {\n          node: null,\n          previous_node: node\n        });\n      }\n    } else {\n      deselected_node = this.getSelectedNode();\n      this._deselectCurrentNode();\n      this.addToSelection(node);\n      this._triggerEvent('tree.select', {\n        node: node,\n        deselected_node: deselected_node\n      });\n      openParents();\n    }\n    return saveState();\n  };\n\n  JqTreeWidget.prototype.getSelectedNode = function() {\n    if (this.select_node_handler) {\n      return this.select_node_handler.getSelectedNode();\n    } else {\n      return null;\n    }\n  };\n\n  JqTreeWidget.prototype.toJson = function() {\n    return JSON.stringify(this.tree.getData());\n  };\n\n  JqTreeWidget.prototype.loadData = function(data, parent_node) {\n    this._loadData(data, parent_node);\n    return this.element;\n  };\n\n\n  /*\n  signatures:\n  - loadDataFromUrl(url, parent_node=null, on_finished=null)\n      loadDataFromUrl('/my_data');\n      loadDataFromUrl('/my_data', node1);\n      loadDataFromUrl('/my_data', node1, function() { console.log('finished'); });\n      loadDataFromUrl('/my_data', null, function() { console.log('finished'); });\n  \n  - loadDataFromUrl(parent_node=null, on_finished=null)\n      loadDataFromUrl();\n      loadDataFromUrl(node1);\n      loadDataFromUrl(null, function() { console.log('finished'); });\n      loadDataFromUrl(node1, function() { console.log('finished'); });\n   */\n\n  JqTreeWidget.prototype.loadDataFromUrl = function(param1, param2, param3) {\n    if ($.type(param1) === 'string') {\n      this._loadDataFromUrl(param1, param2, param3);\n    } else {\n      this._loadDataFromUrl(null, param1, param2);\n    }\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.reload = function(on_finished) {\n    this._loadDataFromUrl(null, null, on_finished);\n    return this.element;\n  };\n\n  JqTreeWidget.prototype._loadDataFromUrl = function(url_info, parent_node, on_finished) {\n    var $el, addLoadingClass, handeLoadData, loadDataFromUrlInfo, parseUrlInfo, removeLoadingClass;\n    $el = null;\n    addLoadingClass = (function(_this) {\n      return function() {\n        if (parent_node) {\n          $el = $(parent_node.element);\n        } else {\n          $el = _this.element;\n        }\n        return $el.addClass('jqtree-loading');\n      };\n    })(this);\n    removeLoadingClass = function() {\n      if ($el) {\n        return $el.removeClass('jqtree-loading');\n      }\n    };\n    parseUrlInfo = function() {\n      if ($.type(url_info) === 'string') {\n        url_info = {\n          url: url_info\n        };\n      }\n      if (!url_info.method) {\n        return url_info.method = 'get';\n      }\n    };\n    handeLoadData = (function(_this) {\n      return function(data) {\n        removeLoadingClass();\n        _this._loadData(data, parent_node);\n        if (on_finished && $.isFunction(on_finished)) {\n          return on_finished();\n        }\n      };\n    })(this);\n    loadDataFromUrlInfo = (function(_this) {\n      return function() {\n        parseUrlInfo();\n        return $.ajax({\n          url: url_info.url,\n          data: url_info.data,\n          type: url_info.method.toUpperCase(),\n          cache: false,\n          dataType: 'json',\n          success: function(response) {\n            var data;\n            if ($.isArray(response) || typeof response === 'object') {\n              data = response;\n            } else {\n              data = $.parseJSON(response);\n            }\n            if (_this.options.dataFilter) {\n              data = _this.options.dataFilter(data);\n            }\n            return handeLoadData(data);\n          },\n          error: function(response) {\n            removeLoadingClass();\n            if (_this.options.onLoadFailed) {\n              return _this.options.onLoadFailed(response);\n            }\n          }\n        });\n      };\n    })(this);\n    if (!url_info) {\n      url_info = this._getDataUrlInfo(parent_node);\n    }\n    addLoadingClass();\n    if (!url_info) {\n      removeLoadingClass();\n    } else if ($.isArray(url_info)) {\n      handeLoadData(url_info);\n    } else {\n      loadDataFromUrlInfo();\n    }\n  };\n\n  JqTreeWidget.prototype._loadData = function(data, parent_node) {\n    var deselectNodes, loadSubtree;\n    if (parent_node == null) {\n      parent_node = null;\n    }\n    deselectNodes = (function(_this) {\n      return function() {\n        var i, len, n, selected_nodes_under_parent;\n        if (_this.select_node_handler) {\n          selected_nodes_under_parent = _this.select_node_handler.getSelectedNodesUnder(parent_node);\n          for (i = 0, len = selected_nodes_under_parent.length; i < len; i++) {\n            n = selected_nodes_under_parent[i];\n            _this.select_node_handler.removeFromSelection(n);\n          }\n        }\n        return null;\n      };\n    })(this);\n    loadSubtree = (function(_this) {\n      return function() {\n        parent_node.loadFromData(data);\n        parent_node.load_on_demand = false;\n        parent_node.is_loading = false;\n        return _this._refreshElements(parent_node);\n      };\n    })(this);\n    if (!data) {\n      return;\n    }\n    this._triggerEvent('tree.load_data', {\n      tree_data: data\n    });\n    if (!parent_node) {\n      this._initTree(data);\n    } else {\n      deselectNodes();\n      loadSubtree();\n    }\n    if (this.isDragging()) {\n      return this.dnd_handler.refresh();\n    }\n  };\n\n  JqTreeWidget.prototype.getNodeById = function(node_id) {\n    return this.tree.getNodeById(node_id);\n  };\n\n  JqTreeWidget.prototype.getNodeByName = function(name) {\n    return this.tree.getNodeByName(name);\n  };\n\n  JqTreeWidget.prototype.getNodesByProperty = function(key, value) {\n    return this.tree.getNodesByProperty(key, value);\n  };\n\n  JqTreeWidget.prototype.openNode = function(node, slide) {\n    if (slide == null) {\n      slide = null;\n    }\n    if (slide === null) {\n      slide = this.options.slide;\n    }\n    this._openNode(node, slide);\n    return this.element;\n  };\n\n  JqTreeWidget.prototype._openNode = function(node, slide, on_finished) {\n    var doOpenNode, parent;\n    if (slide == null) {\n      slide = true;\n    }\n    doOpenNode = (function(_this) {\n      return function(_node, _slide, _on_finished) {\n        var folder_element;\n        folder_element = new FolderElement(_node, _this);\n        return folder_element.open(_on_finished, _slide);\n      };\n    })(this);\n    if (node.isFolder()) {\n      if (node.load_on_demand) {\n        return this._loadFolderOnDemand(node, slide, on_finished);\n      } else {\n        parent = node.parent;\n        while (parent) {\n          if (parent.parent) {\n            doOpenNode(parent, false, null);\n          }\n          parent = parent.parent;\n        }\n        doOpenNode(node, slide, on_finished);\n        return this._saveState();\n      }\n    }\n  };\n\n  JqTreeWidget.prototype._loadFolderOnDemand = function(node, slide, on_finished) {\n    if (slide == null) {\n      slide = true;\n    }\n    node.is_loading = true;\n    return this._loadDataFromUrl(null, node, (function(_this) {\n      return function() {\n        return _this._openNode(node, slide, on_finished);\n      };\n    })(this));\n  };\n\n  JqTreeWidget.prototype.closeNode = function(node, slide) {\n    if (slide == null) {\n      slide = null;\n    }\n    if (slide === null) {\n      slide = this.options.slide;\n    }\n    if (node.isFolder()) {\n      new FolderElement(node, this).close(slide);\n      this._saveState();\n    }\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.isDragging = function() {\n    if (this.dnd_handler) {\n      return this.dnd_handler.is_dragging;\n    } else {\n      return false;\n    }\n  };\n\n  JqTreeWidget.prototype.refreshHitAreas = function() {\n    this.dnd_handler.refresh();\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.addNodeAfter = function(new_node_info, existing_node) {\n    var new_node;\n    new_node = existing_node.addAfter(new_node_info);\n    this._refreshElements(existing_node.parent);\n    return new_node;\n  };\n\n  JqTreeWidget.prototype.addNodeBefore = function(new_node_info, existing_node) {\n    var new_node;\n    new_node = existing_node.addBefore(new_node_info);\n    this._refreshElements(existing_node.parent);\n    return new_node;\n  };\n\n  JqTreeWidget.prototype.addParentNode = function(new_node_info, existing_node) {\n    var new_node;\n    new_node = existing_node.addParent(new_node_info);\n    this._refreshElements(new_node.parent);\n    return new_node;\n  };\n\n  JqTreeWidget.prototype.removeNode = function(node) {\n    var parent;\n    parent = node.parent;\n    if (parent) {\n      this.select_node_handler.removeFromSelection(node, true);\n      node.remove();\n      this._refreshElements(parent);\n    }\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.appendNode = function(new_node_info, parent_node) {\n    var node;\n    parent_node = parent_node || this.tree;\n    node = parent_node.append(new_node_info);\n    this._refreshElements(parent_node);\n    return node;\n  };\n\n  JqTreeWidget.prototype.prependNode = function(new_node_info, parent_node) {\n    var node;\n    if (!parent_node) {\n      parent_node = this.tree;\n    }\n    node = parent_node.prepend(new_node_info);\n    this._refreshElements(parent_node);\n    return node;\n  };\n\n  JqTreeWidget.prototype.updateNode = function(node, data) {\n    var id_is_changed;\n    id_is_changed = data.id && data.id !== node.id;\n    if (id_is_changed) {\n      this.tree.removeNodeFromIndex(node);\n    }\n    node.setData(data);\n    if (id_is_changed) {\n      this.tree.addNodeToIndex(node);\n    }\n    this.renderer.renderFromNode(node);\n    this._selectCurrentNode();\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.moveNode = function(node, target_node, position) {\n    var position_index;\n    position_index = Position.nameToIndex(position);\n    this.tree.moveNode(node, target_node, position_index);\n    this._refreshElements();\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.getStateFromStorage = function() {\n    return this.save_state_handler.getStateFromStorage();\n  };\n\n  JqTreeWidget.prototype.addToSelection = function(node) {\n    if (node) {\n      this.select_node_handler.addToSelection(node);\n      this._getNodeElementForNode(node).select();\n      this._saveState();\n    }\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.getSelectedNodes = function() {\n    return this.select_node_handler.getSelectedNodes();\n  };\n\n  JqTreeWidget.prototype.isNodeSelected = function(node) {\n    return this.select_node_handler.isNodeSelected(node);\n  };\n\n  JqTreeWidget.prototype.removeFromSelection = function(node) {\n    this.select_node_handler.removeFromSelection(node);\n    this._getNodeElementForNode(node).deselect();\n    this._saveState();\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.scrollToNode = function(node) {\n    var $element, top;\n    $element = $(node.element);\n    top = $element.offset().top - this.$el.offset().top;\n    this.scroll_handler.scrollTo(top);\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.getState = function() {\n    return this.save_state_handler.getState();\n  };\n\n  JqTreeWidget.prototype.setState = function(state) {\n    this.save_state_handler.setInitialState(state);\n    this._refreshElements();\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.setOption = function(option, value) {\n    this.options[option] = value;\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.moveDown = function() {\n    if (this.key_handler) {\n      this.key_handler.moveDown();\n    }\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.moveUp = function() {\n    if (this.key_handler) {\n      this.key_handler.moveUp();\n    }\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.getVersion = function() {\n    return __version__;\n  };\n\n  JqTreeWidget.prototype._init = function() {\n    JqTreeWidget.__super__._init.call(this);\n    this.element = this.$el;\n    this.mouse_delay = 300;\n    this.is_initialized = false;\n    this.options.rtl = this._getRtlOption();\n    if (!this.options.closedIcon) {\n      this.options.closedIcon = this._getDefaultClosedIcon();\n    }\n    this.renderer = new ElementsRenderer(this);\n    if (SaveStateHandler != null) {\n      this.save_state_handler = new SaveStateHandler(this);\n    } else {\n      this.options.saveState = false;\n    }\n    if (SelectNodeHandler != null) {\n      this.select_node_handler = new SelectNodeHandler(this);\n    }\n    if (DragAndDropHandler != null) {\n      this.dnd_handler = new DragAndDropHandler(this);\n    } else {\n      this.options.dragAndDrop = false;\n    }\n    if (ScrollHandler != null) {\n      this.scroll_handler = new ScrollHandler(this);\n    }\n    if ((KeyHandler != null) && (SelectNodeHandler != null)) {\n      this.key_handler = new KeyHandler(this);\n    }\n    this._initData();\n    this.element.click($.proxy(this._click, this));\n    this.element.dblclick($.proxy(this._dblclick, this));\n    if (this.options.useContextMenu) {\n      return this.element.bind('contextmenu', $.proxy(this._contextmenu, this));\n    }\n  };\n\n  JqTreeWidget.prototype._deinit = function() {\n    this.element.empty();\n    this.element.unbind();\n    if (this.key_handler) {\n      this.key_handler.deinit();\n    }\n    this.tree = null;\n    return JqTreeWidget.__super__._deinit.call(this);\n  };\n\n  JqTreeWidget.prototype._initData = function() {\n    if (this.options.data) {\n      return this._loadData(this.options.data);\n    } else {\n      return this._loadDataFromUrl(this._getDataUrlInfo());\n    }\n  };\n\n  JqTreeWidget.prototype._getDataUrlInfo = function(node) {\n    var data_url, getUrlFromString;\n    data_url = this.options.dataUrl || this.element.data('url');\n    getUrlFromString = (function(_this) {\n      return function() {\n        var data, selected_node_id, url_info;\n        url_info = {\n          url: data_url\n        };\n        if (node && node.id) {\n          data = {\n            node: node.id\n          };\n          url_info['data'] = data;\n        } else {\n          selected_node_id = _this._getNodeIdToBeSelected();\n          if (selected_node_id) {\n            data = {\n              selected_node: selected_node_id\n            };\n            url_info['data'] = data;\n          }\n        }\n        return url_info;\n      };\n    })(this);\n    if ($.isFunction(data_url)) {\n      return data_url(node);\n    } else if ($.type(data_url) === 'string') {\n      return getUrlFromString();\n    } else {\n      return data_url;\n    }\n  };\n\n  JqTreeWidget.prototype._getNodeIdToBeSelected = function() {\n    if (this.options.saveState) {\n      return this.save_state_handler.getNodeIdToBeSelected();\n    } else {\n      return null;\n    }\n  };\n\n  JqTreeWidget.prototype._initTree = function(data) {\n    var doInit, must_load_on_demand;\n    doInit = (function(_this) {\n      return function() {\n        if (!_this.is_initialized) {\n          _this.is_initialized = true;\n          return _this._triggerEvent('tree.init');\n        }\n      };\n    })(this);\n    this.tree = new this.options.nodeClass(null, true, this.options.nodeClass);\n    if (this.select_node_handler) {\n      this.select_node_handler.clear();\n    }\n    this.tree.loadFromData(data);\n    must_load_on_demand = this._setInitialState();\n    this._refreshElements();\n    if (!must_load_on_demand) {\n      return doInit();\n    } else {\n      return this._setInitialStateOnDemand(doInit);\n    }\n  };\n\n  JqTreeWidget.prototype._setInitialState = function() {\n    var autoOpenNodes, is_restored, must_load_on_demand, ref2, restoreState;\n    restoreState = (function(_this) {\n      return function() {\n        var must_load_on_demand, state;\n        if (!(_this.options.saveState && _this.save_state_handler)) {\n          return [false, false];\n        } else {\n          state = _this.save_state_handler.getStateFromStorage();\n          if (!state) {\n            return [false, false];\n          } else {\n            must_load_on_demand = _this.save_state_handler.setInitialState(state);\n            return [true, must_load_on_demand];\n          }\n        }\n      };\n    })(this);\n    autoOpenNodes = (function(_this) {\n      return function() {\n        var max_level, must_load_on_demand;\n        if (_this.options.autoOpen === false) {\n          return false;\n        }\n        max_level = _this._getAutoOpenMaxLevel();\n        must_load_on_demand = false;\n        _this.tree.iterate(function(node, level) {\n          if (node.load_on_demand) {\n            must_load_on_demand = true;\n            return false;\n          } else if (!node.hasChildren()) {\n            return false;\n          } else {\n            node.is_open = true;\n            return level !== max_level;\n          }\n        });\n        return must_load_on_demand;\n      };\n    })(this);\n    ref2 = restoreState(), is_restored = ref2[0], must_load_on_demand = ref2[1];\n    if (!is_restored) {\n      must_load_on_demand = autoOpenNodes();\n    }\n    return must_load_on_demand;\n  };\n\n  JqTreeWidget.prototype._setInitialStateOnDemand = function(cb_finished) {\n    var autoOpenNodes, restoreState;\n    restoreState = (function(_this) {\n      return function() {\n        var state;\n        if (!(_this.options.saveState && _this.save_state_handler)) {\n          return false;\n        } else {\n          state = _this.save_state_handler.getStateFromStorage();\n          if (!state) {\n            return false;\n          } else {\n            _this.save_state_handler.setInitialStateOnDemand(state, cb_finished);\n            return true;\n          }\n        }\n      };\n    })(this);\n    autoOpenNodes = (function(_this) {\n      return function() {\n        var loadAndOpenNode, loading_count, max_level, openNodes;\n        max_level = _this._getAutoOpenMaxLevel();\n        loading_count = 0;\n        loadAndOpenNode = function(node) {\n          loading_count += 1;\n          return _this._openNode(node, false, function() {\n            loading_count -= 1;\n            return openNodes();\n          });\n        };\n        openNodes = function() {\n          _this.tree.iterate(function(node, level) {\n            if (node.load_on_demand) {\n              if (!node.is_loading) {\n                loadAndOpenNode(node);\n              }\n              return false;\n            } else {\n              _this._openNode(node, false);\n              return level !== max_level;\n            }\n          });\n          if (loading_count === 0) {\n            return cb_finished();\n          }\n        };\n        return openNodes();\n      };\n    })(this);\n    if (!restoreState()) {\n      return autoOpenNodes();\n    }\n  };\n\n  JqTreeWidget.prototype._getAutoOpenMaxLevel = function() {\n    if (this.options.autoOpen === true) {\n      return -1;\n    } else {\n      return parseInt(this.options.autoOpen);\n    }\n  };\n\n\n  /*\n  Redraw the tree or part of the tree.\n   * from_node: redraw this subtree\n   */\n\n  JqTreeWidget.prototype._refreshElements = function(from_node) {\n    if (from_node == null) {\n      from_node = null;\n    }\n    this.renderer.render(from_node);\n    return this._triggerEvent('tree.refresh');\n  };\n\n  JqTreeWidget.prototype._click = function(e) {\n    var click_target, event, node;\n    click_target = this._getClickTarget(e.target);\n    if (click_target) {\n      if (click_target.type === 'button') {\n        this.toggle(click_target.node, this.options.slide);\n        e.preventDefault();\n        return e.stopPropagation();\n      } else if (click_target.type === 'label') {\n        node = click_target.node;\n        event = this._triggerEvent('tree.click', {\n          node: node,\n          click_event: e\n        });\n        if (!event.isDefaultPrevented()) {\n          return this._selectNode(node, true);\n        }\n      }\n    }\n  };\n\n  JqTreeWidget.prototype._dblclick = function(e) {\n    var click_target;\n    click_target = this._getClickTarget(e.target);\n    if (click_target && click_target.type === 'label') {\n      return this._triggerEvent('tree.dblclick', {\n        node: click_target.node,\n        click_event: e\n      });\n    }\n  };\n\n  JqTreeWidget.prototype._getClickTarget = function(element) {\n    var $button, $el, $target, node;\n    $target = $(element);\n    $button = $target.closest('.jqtree-toggler');\n    if ($button.length) {\n      node = this._getNode($button);\n      if (node) {\n        return {\n          type: 'button',\n          node: node\n        };\n      }\n    } else {\n      $el = $target.closest('.jqtree-element');\n      if ($el.length) {\n        node = this._getNode($el);\n        if (node) {\n          return {\n            type: 'label',\n            node: node\n          };\n        }\n      }\n    }\n    return null;\n  };\n\n  JqTreeWidget.prototype._getNode = function($element) {\n    var $li;\n    $li = $element.closest('li.jqtree_common');\n    if ($li.length === 0) {\n      return null;\n    } else {\n      return $li.data('node');\n    }\n  };\n\n  JqTreeWidget.prototype._getNodeElementForNode = function(node) {\n    if (node.isFolder()) {\n      return new FolderElement(node, this);\n    } else {\n      return new NodeElement(node, this);\n    }\n  };\n\n  JqTreeWidget.prototype._getNodeElement = function($element) {\n    var node;\n    node = this._getNode($element);\n    if (node) {\n      return this._getNodeElementForNode(node);\n    } else {\n      return null;\n    }\n  };\n\n  JqTreeWidget.prototype._contextmenu = function(e) {\n    var $div, node;\n    $div = $(e.target).closest('ul.jqtree-tree .jqtree-element');\n    if ($div.length) {\n      node = this._getNode($div);\n      if (node) {\n        e.preventDefault();\n        e.stopPropagation();\n        this._triggerEvent('tree.contextmenu', {\n          node: node,\n          click_event: e\n        });\n        return false;\n      }\n    }\n  };\n\n  JqTreeWidget.prototype._saveState = function() {\n    if (this.options.saveState) {\n      return this.save_state_handler.saveState();\n    }\n  };\n\n  JqTreeWidget.prototype._mouseCapture = function(position_info) {\n    if (this.options.dragAndDrop) {\n      return this.dnd_handler.mouseCapture(position_info);\n    } else {\n      return false;\n    }\n  };\n\n  JqTreeWidget.prototype._mouseStart = function(position_info) {\n    if (this.options.dragAndDrop) {\n      return this.dnd_handler.mouseStart(position_info);\n    } else {\n      return false;\n    }\n  };\n\n  JqTreeWidget.prototype._mouseDrag = function(position_info) {\n    var result;\n    if (this.options.dragAndDrop) {\n      result = this.dnd_handler.mouseDrag(position_info);\n      if (this.scroll_handler) {\n        this.scroll_handler.checkScrolling();\n      }\n      return result;\n    } else {\n      return false;\n    }\n  };\n\n  JqTreeWidget.prototype._mouseStop = function(position_info) {\n    if (this.options.dragAndDrop) {\n      return this.dnd_handler.mouseStop(position_info);\n    } else {\n      return false;\n    }\n  };\n\n  JqTreeWidget.prototype._triggerEvent = function(event_name, values) {\n    var event;\n    event = $.Event(event_name);\n    $.extend(event, values);\n    this.element.trigger(event);\n    return event;\n  };\n\n  JqTreeWidget.prototype.testGenerateHitAreas = function(moving_node) {\n    this.dnd_handler.current_item = this._getNodeElementForNode(moving_node);\n    this.dnd_handler.generateHitAreas();\n    return this.dnd_handler.hit_areas;\n  };\n\n  JqTreeWidget.prototype._selectCurrentNode = function() {\n    var node, node_element;\n    node = this.getSelectedNode();\n    if (node) {\n      node_element = this._getNodeElementForNode(node);\n      if (node_element) {\n        return node_element.select();\n      }\n    }\n  };\n\n  JqTreeWidget.prototype._deselectCurrentNode = function() {\n    var node;\n    node = this.getSelectedNode();\n    if (node) {\n      return this.removeFromSelection(node);\n    }\n  };\n\n  JqTreeWidget.prototype._getDefaultClosedIcon = function() {\n    if (this.options.rtl) {\n      return '&#x25c0;';\n    } else {\n      return '&#x25ba;';\n    }\n  };\n\n  JqTreeWidget.prototype._getRtlOption = function() {\n    var data_rtl;\n    if (this.options.rtl !== null) {\n      return this.options.rtl;\n    } else {\n      data_rtl = this.element.data('rtl');\n      if ((data_rtl != null) && data_rtl !== false) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  };\n\n  return JqTreeWidget;\n\n})(MouseWidget);\n\nJqTreeWidget.getModule = function(name) {\n  var modules;\n  modules = {\n    'node': node_module,\n    'util': util_module\n  };\n  return modules[name];\n};\n\nSimpleWidget.register(JqTreeWidget, 'tree');\n\n},{\"./drag_and_drop_handler\":1,\"./elements_renderer\":2,\"./key_handler\":3,\"./mouse.widget\":4,\"./node\":5,\"./node_element\":6,\"./save_state_handler\":7,\"./scroll_handler\":8,\"./select_node_handler\":9,\"./simple.widget\":10,\"./util\":12,\"./version\":13}],12:[function(require,module,exports){\nvar _indexOf, getBoolString, html_escape, indexOf, isInt;\n\n_indexOf = function(array, item) {\n  var i, j, len, value;\n  for (i = j = 0, len = array.length; j < len; i = ++j) {\n    value = array[i];\n    if (value === item) {\n      return i;\n    }\n  }\n  return -1;\n};\n\nindexOf = function(array, item) {\n  if (array.indexOf) {\n    return array.indexOf(item);\n  } else {\n    return _indexOf(array, item);\n  }\n};\n\nisInt = function(n) {\n  return typeof n === 'number' && n % 1 === 0;\n};\n\nhtml_escape = function(string) {\n  return ('' + string).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&#x27;').replace(/\\//g, '&#x2F;');\n};\n\ngetBoolString = function(value) {\n  if (value) {\n    return 'true';\n  } else {\n    return 'false';\n  }\n};\n\nmodule.exports = {\n  _indexOf: _indexOf,\n  getBoolString: getBoolString,\n  html_escape: html_escape,\n  indexOf: indexOf,\n  isInt: isInt\n};\n\n},{}],13:[function(require,module,exports){\nmodule.exports = '1.3.0';\n\n},{}]},{},[11]);","var rex_treestructure = {\n\ttreeCss : 'treetructure--tree',\n\tnew_article : null,\n\tnew_category : null,\n\tis_touch : \"ontouchstart\" in document.documentElement,\n\n\tinit : function() {\n\t\tthis.createEvents();\n\t\tthis.createTree();\n\t\tif(this.is_touch) {\n\t\t\t$('#' + this.treeCss).addClass('is--touch');\n\t\t}\n\t\telse {\n\t\t\t$('#' + this.treeCss).addClass('is--no-touch');\n\t\t}\n\t},\n\n\tcreateEvents : function() {\n\t\tvar tree = $('#' + this.treeCss);\n\n\t\t// attach click events on option icons...\n\t\ttree.on({\n\t\t\t'click.treestructure' : function(e) {\n\n\t\t\t\tvar action = $(this).attr('class').match(/treestructure--options--([^ ]+)( |$)/),\n\t\t\t\t\t$tree = $(this).parents('#'+rex_treestructure.treeCss).first(),\n\t\t\t\t\t$li = $(this).parents('li').first(),\n\t\t\t\t\tid = $li.attr('data-id'),\n\t\t\t\t\tnode = $tree ? $tree.tree('getNodeById', id) : null;\n\n\t\t\t\tif(!action || !$tree || $(this).css('opacity')<1) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\taction = action[1].replace(/-([a-z])/g, function (g) { return g[1].toUpperCase(); });\n\n\t\t\t\tif(typeof rex_treestructure.itemActions[action] == 'function') {\n\t\t\t\t\tif($(this).attr('data-confirm')) {\n\t\t\t\t\t\tvar valid = true;\n\t\t\t\t\t\tif(e.shiftKey) {\n\t\t\t\t\t\t\tvalid = node.name == prompt(rex_treestructure._translate($(this).attr('data-confirm'),{name:node.name}) + \"\\n\" + rex_treestructure._translate('type_in_name_to_confirm',{name:node.name}));\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tvalid = confirm(rex_treestructure._translate($(this).attr('data-confirm'),{name:node.name}));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif(!valid) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\trex_treestructure.itemActions[action](node, $li, $tree, e.shiftKey);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\t'mousedown.treestructure' : function(e) {\n\t\t\t\t// prevent dragging on option spans\n\t\t\t\ttry { e.preventDefault(); }\tcatch(ev) {}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t},'.treestructure--options span[class*=\"treestructure--options--\"]');\n\n\t\t// submit forms within the tree\n\t\ttree.on({\n\t\t\t'submit.treestructure' : function(e) {\n    \t\t\ttry { e.preventDefault(); } catch(ev) {};\n\n\t\t\t\tif($(this).find('input[name=\"name\"]').length) {\n\t\t\t\t\t$(this).find('input[name=\"name\"]').val($.trim($(this).find('input[name=\"name\"]').val()).replace(/\\s/g,' ').replace(/ +/g,' '));\n\n\t\t\t\t\tif($(this).find('input[name=\"name\"]').val() == '') {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\trex_treestructure.ajaxAction($(this).serialize(), rex_treestructure.updateTree);\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\t'reset.treestructure' : function() {\n\t\t\t\tvar node = $(this).tree('getNodeById', -1) || null;\n\n\t\t\t\tif(node) {\n\t\t\t\t\t// there is a \"new\" node open - remove it!\n\t\t\t\t\t$(this).tree('removeNode', node);\n\t\t\t\t}\n\n\t\t\t\t// remove any open edit fields...\n\t\t\t\tif($(this).find('.treestructure--edit-node').length) {\n\t\t\t\t\t$(this).find('.treestructure--edit-node').each(function(i, el){\n\t\t\t\t\t\tvar $li = $(el).parents('li').first();\n\t\t\t\t\t\t$li.removeClass('is--editing');\n\t\t\t\t\t\t$li.find('>.jqtree-element>.jqtree-title').html($li.data('tmp-html'));\n\t\t\t\t\t\t$li.data('tmp-html', null);\n\n\t\t\t\t\t\t$(el).remove();\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t},\n\n\tupdateTree : function() {\n\t\tvar tree = $('#' + rex_treestructure.treeCss),\n\t\t\tstates = $('#' + rex_treestructure.treeCss).tree('getState');\n\n\t\ttree.tree(\n\t\t\t'loadDataFromUrl',\n\t\t\ttree.attr('data-url'),\n\t\t\tnull,\n\t\t\tfunction() {\n\t\t\t\ttree.tree('setOption', 'dragAndDrop', true);\n\t\t\t\ttree.tree('setState', states);\n\n\t\t\t\trex_treestructure.editTree(false);\n\t\t\t}\n\t\t);\n\t},\n\n\teditTree : function() {\n\t\tvar tree = $('#' + rex_treestructure.treeCss);\n\n\t\tif(typeof arguments[0] != 'undefined') {\n\t\t\tvar on = arguments[0] === true;\n\t\t\tif(on) {\n\t\t\t\t// disable Drag&Drop\n\t\t\t\ttree.tree('setOption', 'dragAndDrop', false);\n\t\t\t\t\n\t\t\t\t// add CSS class\n\t\t\t\ttree.addClass('is--edit');\n\n\t\t\t\t// watch ESC key to disable edit mode again\n\t\t\t\t$(document).on('keyup.treestructure', function(e) {\n\t\t\t\t\tif (e.keyCode == 27) { // escape key maps to keycode `27`\n\t\t\t\t\t\trex_treestructure.editTree(false);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// remove any form\n\t\t\t\ttree.trigger('reset.treestructure');\n\n\t\t\t\t// remove any ESC functionality\n\t\t\t\t$(document).off('keyup.treestructure');\n\n\t\t\t\t// enable Drag&Drop again\n\t\t\t\ttree.tree('setOption', 'dragAndDrop', true);\n\t\t\t\t\n\t\t\t\t// remove CSS class\n\t\t\t\ttree.removeClass('is--edit');\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// return if tree is in edit mode...\n\t\t\treturn tree.hasClass('is--edit');\n\t\t}\n\t},\n\n\tloadingTree : function() {\n\t\tvar on = typeof arguments[0] != 'undefined' && arguments[0] === true,\n\t\t\ttree = $('#' + rex_treestructure.treeCss);\n\n\t\tif(on) {\n\t\t\t// add CSS class\n\t\t\ttree.addClass('is--loading');\n\t\t}\n\t\telse {\n\t\t\t// add CSS class\n\t\t\ttree.removeClass('is--loading');\n\t\t}\n\n\t\treturn tree;\n\t},\n\n\t_translate : function(key, replacements) {\n\t\tvar $tree = $('#' + rex_treestructure.treeCss) || null,\n\t\t\ttranslations = null;\n\n\t\tif($tree.attr('data-translations')) {\n\t\t\ttranslations = JSON.parse($tree.attr('data-translations'));\n\n\t\t\tif(typeof translations == 'object') {\n\t\t\t\tif(typeof translations[key] != 'undefined') {\n\t\t\t\t\tkey = translations[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif(typeof replacements == 'object') {\n\t\t\tfor(var p in replacements) {\n\t\t\t\tkey = key.replace('{{' + p + '}}', replacements[p]);\n\t\t\t}\n\t\t}\n\n\t\treturn key;\n\t},\n\n\tajaxAction : function(data) {\n\t\tif(typeof(data) == 'undefined') {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar tree = rex_treestructure.loadingTree(true),\n\t\t\tjqxhr,\n\t\t\tonSuccess = typeof(arguments[1]) == 'function' ? arguments[1] : null,\n\t\t\tformData;\n\n\t\t// convert it into params\n\t\tif(data instanceof FormData || typeof data == 'string') {\n\t\t\tformData = data\n\t\t}\n\t\telse {\n\t\t\tformData = Object.keys(data).map(function(k) { return encodeURIComponent(k) + '=' + encodeURIComponent(data[k]) }).join('&');\n\t\t}\n\n\t\tvar request = new XMLHttpRequest();\n\t\trequest.open(tree.attr('method') || 'GET', tree.attr('action'), true);\n\t\trequest.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded\");\n\n\t\tif(onSuccess) {\n\t\t\trequest.onSuccess = onSuccess;\n\t\t}\n\n\t\trequest.onload = function() {\n\t\t\tvar data = JSON.parse(this.responseText),\n\t\t\t\tstatus = this.status,\n\t\t\t\ttree = rex_treestructure.loadingTree(false),\n\t\t\t\talert,\n\t\t\t\tduration = 2000,\n\t\t\t\twait = 0;\n\n\t\t\tif (request.status >= 200 && request.status < 400) {\n\t\t\t\t// SUCCESS!\n\t\t\t\t\n\t\t    \tif(this.onSuccess) {\n\t\t\t\t\tthis.onSuccess(data);\n\t\t\t\t}\n\n\t\t  \t} else {\n\t\t    \t// ERROR\n\t\t    \t\n\t\t\t}\n\n\t\t\t// ALWAYS...\n\n\t\t\t// display alerts?!\n\t\t\tif(typeof data.notice != 'undefined') {\n\t\t\t\talert = $('<div id=\"treestructure--alert\" class=\"alert alert-success\" />').text(data.notice);\n\t\t\t}\n\t\t\telse if(typeof data.error != 'undefined') {\n\t\t\t\talert = $('<div id=\"treestructure--alert\" class=\"alert alert-danger\" />').text(data.error);\n\t\t\t\twait = 3000;\n\t\t\t}\n\n\t\t\tif(alert) {\n\t\t\t\talert.insertBefore(tree);\n\n\t\t\t\talert.data('fadeFunc', function(duration){ $(this).animate({'opacity' : 0}, duration, function(){ $(this).remove(); }); }.bind(alert, duration));\n\n\t\t\t\tif(wait > 0) {\n\t\t\t\t\talert.data('timeout', window.setTimeout(alert.data('fadeFunc'), wait));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\talert.data('fadeFunc')();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\trequest.send(formData);\n\t},\n\n\titemActions : {\n\t\tdelete : function(node, $li, $tree) {\n\t\t\tif($li.hasClass('cannot-delete')) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\trex_treestructure.ajaxAction({\n\t\t\t\taction : 'delete',\n\t\t\t\tid : node.id,\n\t\t\t\ttype : node.type,\n\t\t\t\tforce : arguments[3] === true\n\t\t\t}, rex_treestructure.updateTree);\n\t\t},\n\n\t\tedit : function(node, $li, $tree) {\n\t\t\tif($li.hasClass('cannot-edit')) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\trex_treestructure.editTree(true);\n\n\t\t\trex_treestructure.ajaxAction({\n\t\t\t\taction : 'editform',\n\t\t\t\tcategory_id : -1,\n\t\t\t\tid : node.id,\n\t\t\t\ttype : node.type\n\t\t\t}, function(data) {\n\t\t\t\t$li.addClass('is--editing').data('tmp-html', $li.find('>.jqtree-element>.jqtree-title').html());\n\t\t\t\t$li.find('>.jqtree-element>.jqtree-title').html(data.html);\n\n\t\t\t\t// focus input fields\n\t\t\t\t$li.find('>.jqtree-element>.jqtree-title').find('input').focus();\n\t\t\t}.bind($li)\n\t\t\t);\n\n\t\t},\n\n\t\tstatus : function(node, $li, $tree) {\n\t\t\tif($li.hasClass('cannot-publish')) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\trex_treestructure.ajaxAction({\n\t\t\t\taction : 'status',\n\t\t\t\tid : node.id,\n\t\t\t\ttype : node.type,\n\t\t\t\tstatus : node.status ? false : true\n\t\t\t}, rex_treestructure.updateTree);\n\t\t},\n\n\t\tnewCategory : function(node, $li, $tree) {\n\t\t\tif($li.hasClass('cannot-edit')) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis._newElement(\n\t\t\t\tnode,\n\t\t\t\t$li,\n\t\t\t\t$tree,\n\t\t\t\t'category'\n\t\t\t);\n\t\t},\n\n\t\tnewArticle : function(node, $li, $tree) {\n\t\t\tif($li.hasClass('cannot-edit')) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis._newElement(\n\t\t\t\tnode,\n\t\t\t\t$li,\n\t\t\t\t$tree,\n\t\t\t\t'article'\n\t\t\t);\n\t\t},\n\n\t\t_newElement : function(node, $li, $tree, type) {\n\t\t\trex_treestructure.editTree(true);\n\n\t\t\trex_treestructure.ajaxAction({\n\t\t\t\taction : 'editform',\n\t\t\t\tcategory_id : node.id,\n\t\t\t\ttype : type\n\t\t\t}, function(data) {\n\n\t\t\t\tthis.newNode.label = data.html;\n\n\t\t\t\tif(this.targetNode != null) {\n\t\t\t\t\tthis.targetNode = this.$tree.tree('getNodeById', this.targetNode.attr('data-id'));\n\t\t\t\t\tvar test = this.$tree.tree('addNodeAfter', this.newNode, this.targetNode);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar test = this.$tree.tree('appendNode', this.newNode, this.node);\n\t\t\t\t}\n\n\t\t\t\t// open li if not already opened...\n\t\t\t\tthis.$tree.tree('openNode', this.node, false);\n\n\t\t\t\t// focus input fields\n\t\t\t\t$(test.element).find('input').focus();\n\t\t\t}.bind({\n\t\t\t\tnode : node,\n\t\t\t\tnewNode : {\n\t\t\t\t\t'id' : -1,\n\t\t\t\t\t'type' : type,\n\t\t\t\t\t'status' : false,\n\t\t\t\t\t'has_children' : false,\n\t\t\t\t\t'cat_perm' : node.cat_perm\n\t\t\t\t},\n\t\t\t\t$tree : $tree,\n\t\t\t\ttargetNode : $li.find('>ul.jqtree_common>li.treestructure--'+type).length ? $li.find('>ul.jqtree_common>li.treestructure--'+type).last() : null\n\t\t\t})\n\t\t\t);\n\t\t},\n\n\t\tview : function(node, $li, $tree) {\n\t\t\twindow.open(node.url);\n\t\t},\n\n\t\tmetadata : function(node, $li, $tree) {\n\t\t\twindow.location.href = '?page=content/metainfo&article_id=' + node.id;\n\t\t},\n\n\t\tfunctions : function(node, $li, $tree) {\n\t\t\twindow.location.href = '?page=content/functions&article_id=' + node.id;\n\t\t},\n\n\t\t_expandCollapseAll : function($tree) {\n\t\t\tvar open = (arguments[1] === true && typeof arguments[2] == 'undefined') || (arguments[2] === true),\n\t\t\t\ttree = typeof arguments[2] != 'undefined' ? arguments[1] : $tree.tree('getTree');\n\n\t\t\tif(tree.type != 'root') {\n\t\t\t\t$tree.tree(open ? 'openNode' : 'closeNode', tree);\n\t\t\t}\n\n\t\t\ttree.iterate(\n\t\t\t    function(node, level) {\n\t\t            $tree.tree(open ? 'openNode' : 'closeNode', node);\n\t\t\t\t\treturn true;\n\t\t\t    }\n\t\t\t);\n\t\t},\n\n\t\texpandAll : function(node, $li, $tree) {\n\t\t\tthis._expandCollapseAll($tree, node, true);\n\t\t},\n\n\t\tcollapseAll : function(node, $li, $tree) {\n\t\t\tthis._expandCollapseAll($tree, node, false);\n\t\t},\n\t},\n\n\tcreateTree : function() {\n\t\t$('#' + this.treeCss).tree({\n\t\t\tautoEscape : false,\n\t\t\tautoOpen : 1,\n\t\t\tuseContextMenu : false,\n\t\t\tdragAndDrop: true,\n    \t\tsaveState: 'treestructure-tree',\n    \t\tselectable : false,\n\t\t\tonCanMoveTo: function(moved_node, target_node, position) {\n\t\t\t\tvar sameCategory = moved_node.parent.id == target_node.parent.id,\n\t\t\t\t\tnextTargetItem = target_node.getNextSibling(),\n\t\t\t\t\tprevTargetItem = target_node.getPreviousSibling();\n\n\n\t\t\t\tif(position != 'inside' && !target_node.parent.parent) {\n\t\t\t\t\t// cannot move element outside first element\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif(position == 'inside') {\n\n\t\t\t\t\tif(target_node.type == 'article') {\n\t\t\t\t\t\t// cannot move element into articles\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(moved_node.type == 'article' && moved_node.parent.id == target_node.id) {\n\t\t\t\t\t\t// cannot move element when it is already within target category\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(moved_node.permissions.match(/cannot-move/) && moved_node.parent.id != target_node.id) {\n\t\t\t\t\t\t// can only move element within its parent category (permissions!)\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif(moved_node.permissions.match(/cannot-move/) && moved_node.parent.id != target_node.parent.id) {\n\t\t\t\t\t\t// can only move element within its parent category (permissions!)\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif(!sameCategory) {\n\t\t\t\t\tp = target_node.parent;\n\t\t\t\t\twhile(p) {\n\t\t\t\t\t\tif(p.id == moved_node.id) {\n\t\t\t\t\t\t\t// don't move within itself\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tp = p.parent;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar moveNodeBeforeTargetNode = true;\n\n\t\t\t\tfor(var i = 0; i < moved_node.parent.children.length; i++) {\n\t\t\t\t\tvar child = moved_node.parent.children[i];\n\t\t\t\t\t\n\t\t\t\t\tif(child.id == moved_node.id) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if(child.id == target_node.id) {\n\t\t\t\t\t\tmoveNodeBeforeTargetNode = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif(moveNodeBeforeTargetNode) {\n\t\t\t\t\tnextTargetItem = nextTargetItem ? nextTargetItem.getNextSibling() : nextTargetItem;\n\t\t\t\t\tprevTargetItem = prevTargetItem ? prevTargetItem.getNextSibling() : prevTargetItem;\n\t\t\t\t}\t\n\n\t\t\t\tif(moved_node.type == 'article' && position == 'after' && nextTargetItem && nextTargetItem.type != 'article') {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif(moved_node.type == 'category' && position == 'after')  {\n\t\t\t\t\tif(nextTargetItem && prevTargetItem) {\n\t\t\t\t\t\tif(prevTargetItem.type != 'category') {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if(prevTargetItem && prevTargetItem.type != 'category') {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\telse if(target_node.type != 'category') {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif(position == 'inside' && target_node.children.length) {\n\t\t\t\t\tposition = 'after';\n\n\t\t\t\t\tfor (var i=target_node.children.length-1; i >= 0;  i--) {\n\t\t\t\t\t    var child = target_node.children[i];\n\t\t\t\t\t    if(child.type == moved_node.type) {\n\t\t\t\t\t    \ttarget_node = child;\n\t\t\t\t\t    \tbreak;\n\t\t\t\t\t    }\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tonCanMove : function(node) {\n\t\t\t\tif (! node.parent.parent) {\n\t\t\t\t\t// Example: Cannot move root node\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t},\n\t\t\tonCreateLi: function(node, $li) {\n\n\t\t\t\t// attach classes...\n\t\t\t\t$li.addClass('treestructure--' + node.type);\n\t\t\t\t$li.addClass(node.status ? 'is--online' : 'is--offline');\n\t\t\t\tif(node.has_children) {\n\t\t\t\t\t$li.addClass('has--children');\n\t\t\t\t}\n\n\t\t\t\tif(node.cat_perm) {\n\t\t\t\t\t$li.addClass('is--allowed');\n\t\t\t\t}\n\n\t\t\t\tif(node.permissions) {\n\t\t\t\t\t$li.addClass(node.permissions);\n\t\t\t\t}\n\n\t\t\t\t$li.addClass('has--prior-' + node.prior);\n\n\t\t\t\tif(node.id < 0) {\n\t\t\t\t\t$li.addClass('is--new');\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t$('#' + rex_treestructure.treeCss).next('.treestructure--options').clone(1,1).insertAfter($li.find('.jqtree-title'));\n\t\t\t\t}\n\n\t\t\t\t// add ID to LI\n\t\t\t\t$li.attr('data-id', node.id);\n\t\t\t}\n\t\t}).on({\n\t\t\t'tree.move' : function(event) {\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tvar move_info = event.move_info;\n\n\t\t\t\ttarget_node = null;\n\t\t\t\tposition = null;\n\n\t\t\t\tmove_info.do_move(target_node, position);\n\n\t\t\t\t// and now get all data to submit movement to REDAXO:\n\t\t\t\trex_treestructure.ajaxAction({\n\t\t\t\t\taction : 'move',\n\t\t\t\t\tid : move_info.moved_node.id,\n\t\t\t\t\tcategory_id : move_info.position == 'inside' ? move_info.target_node.id : move_info.target_node.parent.id,\n\t\t\t\t\tprior : move_info.position == 'inside' ? 1 : parseInt(move_info.target_node.prior),\n\t\t\t\t\ttype : move_info.moved_node.type\n\t\t\t\t}, rex_treestructure.updateTree);\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n}\n\n\n $(document).on('rex:ready', function (event, container) {\n \trex_treestructure.init();\n});"]}